(function(g){var window=this;'use strict';var Q$p=function(k){var G=new g.nv("und",new g.nf("Default","und",!0));G.captionTracks=k.captionTracks;return G},AAc=function(k){return new g.ej(function(G,v){var Q=k.length,A=[];
if(Q)for(var l=function(Z,m){Q--;A[Z]=m;Q==0&&G(A)},f=function(Z){v(Z)},S,O=0;O<k.length;O++)S=k[O],g.JuE(S,g.W7(l,O),f);
else G(A)})},zO=function(k){this.j=k},jO=function(){zO.apply(this,arguments)},ljs=function(){jO.apply(this,arguments)},fjs=function(){jO.apply(this,arguments)},ajM=function(){jO.apply(this,arguments)},i6s=function(){jO.apply(this,arguments)},SBp=function(){jO.apply(this,arguments)},O6A=function(){jO.apply(this,arguments)},Z6n=function(){jO.apply(this,arguments)},mCw=function(){zO.apply(this,arguments)},tPH=function(){jO.apply(this,arguments)},$C5=function(){jO.apply(this,arguments)},JAA=function(){jO.apply(this,
arguments)},rAn=function(){jO.apply(this,arguments)},VPH=function(){jO.apply(this,arguments)},BPc=function(){jO.apply(this,arguments)},wDw=function(){jO.apply(this,arguments)},dCg=function(){jO.apply(this,arguments)},UCg=function(){jO.apply(this,arguments)},cAH=function(){jO.apply(this,arguments)},h5n=function(){jO.apply(this,arguments)},YBw=function(){jO.apply(this,arguments)},XDw=function(){zO.apply(this,arguments)},MPA=function(){jO.apply(this,arguments)},s$p=function(){jO.apply(this,arguments)},
xCA=function(){jO.apply(this,arguments)},e5g=function(){jO.apply(this,arguments)},LVs=function(){jO.apply(this,arguments)},nGc=function(){jO.apply(this,arguments)},gGA=function(){jO.apply(this,arguments)},CMA=function(){jO.apply(this,arguments)},NPp=function(){jO.apply(this,arguments)},uK5=function(){zO.apply(this,arguments)},z5p=function(){zO.apply(this,arguments)},j$A=function(){zO.apply(this,arguments)},b67=function(){jO.apply(this,arguments)},pDn=function(){jO.apply(this,arguments)},WVA=function(){jO.apply(this,
arguments)},Ij5=function(){jO.apply(this,arguments)},yAq=function(){jO.apply(this,arguments)},H6g=function(){jO.apply(this,arguments)},TPH=function(){jO.apply(this,arguments)},R5n=function(){jO.apply(this,arguments)},PMn=function(){jO.apply(this,arguments)},qB5=function(){jO.apply(this,arguments)},oGA=function(){jO.apply(this,arguments)},KVn=function(){jO.apply(this,arguments)},DCs=function(){jO.apply(this,arguments)},FVH=function(){jO.apply(this,arguments)},EGg=function(){jO.apply(this,arguments)},
kWq=function(){jO.apply(this,arguments)},GWn=function(){jO.apply(this,arguments)},v6c=function(){jO.apply(this,arguments)},QYM=function(){jO.apply(this,arguments)},Auc=function(){jO.apply(this,arguments)},lMH=function(){jO.apply(this,arguments)},fMq=function(){jO.apply(this,arguments)},aMH=function(){jO.apply(this,arguments)},ixA=function(){jO.apply(this,arguments)},SEA=function(){jO.apply(this,arguments)},Oxn=function(){jO.apply(this,arguments)},Zxn=function(){jO.apply(this,arguments)},mG7=function(){jO.apply(this,
arguments)},tIg=function(){jO.apply(this,arguments)},$Gq=function(){zO.apply(this,arguments)},JuA=function(){jO.apply(this,arguments)},ruw=function(){jO.apply(this,arguments)},VIn=function(){jO.apply(this,arguments)},Bfp=function(){jO.apply(this,arguments)},w$n=function(){jO.apply(this,arguments)},dGg=function(){jO.apply(this,arguments)},UGg=function(){jO.apply(this,arguments)},cuA=function(){jO.apply(this,arguments)},h8M=function(){jO.apply(this,arguments)},YEn=function(){jO.apply(this,arguments)},
X$p=function(){jO.apply(this,arguments)},MIA=function(){jO.apply(this,arguments)},sYH=function(){jO.apply(this,arguments)},xGn=function(){jO.apply(this,arguments)},e8A=function(){jO.apply(this,arguments)},LtA=function(){jO.apply(this,arguments)},n6s=function(){jO.apply(this,arguments)},g6H=function(){jO.apply(this,arguments)},CGn=function(){jO.apply(this,arguments)},Nf5=function(){jO.apply(this,arguments)},uJA=function(){jO.apply(this,arguments)},z8p=function(){jO.apply(this,arguments)},jYq=function(){jO.apply(this,
arguments)},bxc=function(){jO.apply(this,arguments)},p$H=function(){jO.apply(this,arguments)},WtA=function(){jO.apply(this,arguments)},IMp=function(){jO.apply(this,arguments)},yu5=function(){jO.apply(this,arguments)},HxA=function(){jO.apply(this,arguments)},Tfg=function(){jO.apply(this,arguments)},R8g=function(){jO.apply(this,arguments)},PGA=function(){jO.apply(this,arguments)},qEA=function(){jO.apply(this,arguments)},o6A=function(){jO.apply(this,arguments)},KtA=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},DGc=function(){if(bi)return bi();
var k={};bi=g.v_("PersistentEntityStoreDb",{jP:(k.EntityStore={f4:1},k.EntityAssociationStore={f4:2},k),shared:!1,upgrade:function(G,v){v(1)&&g.uZ(g.e9(G,"EntityStore",{keyPath:"key"}),"entityType","entityType");v(2)&&(G=g.e9(G,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.uZ(G,"byParentEntityKey","parentEntityKey"),g.uZ(G,"byChildEntityKey","childEntityKey"))},
version:3});return bi()},Fts=function(k){return g.HK(DGc(),k)},E65=function(k){return g.HK((0,g.hMw)(),k)},p4=function(k){this.token=k},Wg=function(k,G){G=G===void 0?{}:G;
g.zu.call(this,g.YAq[k],Object.assign({},{name:"PESEncoderError",type:k},G));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,Wg.prototype)},koA=function(k){return new Wg("WRONG_DATA_TYPE",{g1:k})},GoM=function(k){return k instanceof Error?new Wg("UNKNOWN_ENCODE_ERROR",{originalMessage:k.message}):new Wg("UNKNOWN_ENCODE_ERROR")},vkA=function(k){return k instanceof Error?new Wg("UNKNOWN_DECODE_ERROR",{originalMessage:k.message}):new Wg("UNKNOWN_DECODE_ERROR")},QlA=function(k,G){k=k instanceof
Wg?k:G(k);
g.eA(k);throw k;},ASA=function(){},l5H=function(k,G,v){try{return k.Y(G,v)}catch(Q){QlA(Q,GoM)}},f5A=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var G=new Uint8Array(16);G.set(k);return G},Iq=function(k){this.j=k},iGn=function(k){var G=a5A[k];
if(G)return G;g.nw(new g.zu("Entity model not found.",{entityType:k}))},SWs=function(k,G){this.j=k;
this.Z=G;this.Y={}},ZG7=function(k,G){a:{k=OGA(k.Z,G.version);
try{var v=k.Z(G.data,G.key);break a}catch(Q){QlA(Q,vkA)}v=void 0}return v},yT=function(k,G,v){return k.j.objectStore("EntityStore").get(G).then(function(Q){if(Q){if(v&&Q.entityType!==v)throw Error("Incorrect entity type");
return ZG7(k,Q)}})},Hg=function(k,G,v){return v?(v=v.map(function(Q){return yT(k,Q,G)}),g.cK.all(v)):k.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(G)).then(function(Q){return Q.map(function(A){return ZG7(k,A)})})},Rq=function(k,G,v){var Q=KtA(G),A=OGA(k.Z,1),l=Object.assign({},G);
return k.j.objectStore("EntityStore").get(Q).then(function(f){if(f){if(f.entityType!==v)throw Error("Incorrect entity type");l.entityMetadata||(f=ZG7(k,f),l.entityMetadata=f.entityMetadata)}}).then(function(){var f={key:Q,
entityType:v,data:l5H(A,l,Q),version:1};return g.cK.all([g.gO(k.j.objectStore("EntityStore"),f),mQc(k,l,v)])}).then(function(){TO(k,Q,v);
return Q})},t0c=function(k,G,v){G=G.map(function(Q){return Rq(k,Q,v)});
return g.cK.all(G)},Pg=function(k,G,v){if(v==null?0:v.Fl){var Q=new Set;
return $QA(k,G,Q).then(function(){for(var l=[],f=g.n(Q),S=f.next();!S.done;S=f.next())l.push(Pg(k,S.value));return g.cK.all(l).then(function(){})})}var A=g.Hb(G).entityType;
return g.cK.all([k.j.objectStore("EntityStore").delete(G),JSA(k,G)]).then(function(){TO(k,G,A)})},rSs=function(k,G){return g.pi(k.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(G)},function(v){return g.cK.all([v.delete(),
JSA(k,v.cursor.primaryKey)]).then(function(){TO(k,v.cursor.primaryKey,G);return g.j9(v)})})},V0H=function(k,G,v,Q){var A=OGA(k.Z,1);
return yT(k,G,Q).then(function(l){if(l){l=g.iz(l,v);var f={key:G,entityType:Q,data:l5H(A,l,G),version:1};return g.cK.all([g.gO(k.j.objectStore("EntityStore"),f),mQc(k,l,Q)])}}).then(function(){TO(k,G,Q);
return G})},TO=function(k,G,v){var Q=k.Y[v];
Q||(Q=new Set,k.Y[v]=Q);Q.add(G)},BTg=function(k,G,v){var Q=KtA(G);
v=iGn(v);if(!v)return g.cK.resolve([]);v=new v(G);k=k.j.objectStore("EntityAssociationStore");G=[];v=g.n(v.Z());for(var A=v.next();!A.done;A=v.next())G.push(g.gO(k,{parentEntityKey:Q,childEntityKey:A.value}));return g.cK.all(G).then(function(l){return l.map(function(f){return f[1]})})},JSA=function(k,G){return k.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(G))},mQc=function(k,G,v){var Q=KtA(G);
return JSA(k,Q).then(function(){return BTg(k,G,v)})},$QA=function(k,G,v){if(v.has(G))return g.cK.resolve(void 0);
v.add(G);return wRM(k,G).then(function(Q){return k.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(G)).then(function(){return Q})}).then(function(Q){var A=g.cK.resolve(void 0);
Q=g.n(Q);for(var l=Q.next(),f={};!l.done;f={QU:void 0},l=Q.next())f.QU=l.value,A=A.then(function(S){return function(){return $QA(k,S.QU,v)}}(f));
return A}).then(function(){})},wRM=function(k,G){var v=k.j.objectStore("EntityAssociationStore");
return v.index("byParentEntityKey").getAll(IDBKeyRange.only(G)).then(function(Q){var A=[];Q=g.n(Q);for(var l=Q.next();!l.done;l=Q.next())l=l.value,A.push(v.index("byChildEntityKey").getAll(l.childEntityKey));return g.cK.all(A)}).then(function(Q){var A=[];
Q=g.n(Q);for(var l=Q.next();!l.done;l=Q.next())l=l.value,l.length===1&&A.push(l[0].childEntityKey);return A})},qs=function(){},dQ7=function(){this.j={};
this.j[0]=new qs;if(!g.MB("aes_pes_encoder_killswitch")){var k=this.j;try{var G=g.Ka();var v=f5A(G);var Q=new Iq(new g.lH(v),new g.fd(v))}catch(A){throw k=A instanceof Error?new Wg("KEY_CREATION_FAILED",{originalMessage:A.message}):new Wg("KEY_CREATION_FAILED"),g.eA(k),k;}k[1]=Q}},OGA=function(k,G){G=G===void 0?0:G;
k=k.j[G];if(!k)throw G=new Wg("INVALID_ENCODER_VERSION",{g1:G}),g.eA(G),G;return k},oq=function(k,G){g.W.call(this);
this.token=k;this.j=G;this.observers=[];k=new g.sA.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Ka());k.onmessage=this.Z.bind(this);this.channel=k},K4=function(k,G,v){var Q,A,l,f;
return g.b(function(S){if(S.j==1)return g.N(S,Fts(k.token),2);if(S.j!=3)return Q=S.Z,g.N(S,g.ni(Q,["EntityStore","EntityAssociationStore"],G,function(O){A=new SWs(O,k.j);return v(A)}),3);
l=S.Z;A&&(f=A.Y,Object.keys(f).length>0&&(k.channel.postMessage(f),UQw(k,f)));return S.return(l)})},Dg=function(k,G,v){return K4(k,{mode:"readwrite",
O7:!0},function(Q){return Rq(Q,G,v)})},cSp=function(k,G){return K4(k,{mode:"readwrite",
O7:!0},function(v){return t0c(v,G,"offlineOrchestrationActionWrapperEntity")})},hrp=function(k,G){return K4(k,{mode:"readwrite",
O7:!0},function(v){return Pg(v,G)})},YWg=function(k){return K4(k,{mode:"readwrite",
O7:!0},function(G){return rSs(G,"videoPlaybackPositionEntity")})},F0=function(k,G,v){return K4(k,{mode:"readonly",
O7:!0},function(Q){return yT(Q,G,v)})},E2=function(k,G,v){return K4(k,{mode:"readonly",
O7:!0},function(Q){return Hg(Q,G,v)})},UQw=function(k,G){k=g.n(k.observers);
for(var v=k.next();!v.done;v=k.next())v=v.value,v(G)},XRc=function(){var k,G,v;
return g.b(function(Q){if(Q.j==1)return g.OA(Q,2),g.N(Q,g.k_(),4);if(Q.j!=2){k=Q.Z;if(!k||!g.Dm()||typeof g.sA.BroadcastChannel==="undefined")return Q.return();G=new dQ7;return Q.return(new oq(k,G))}v=g.t5(Q);v instanceof Error&&g.eA(v);return Q.return()})},k2=function(){M0q||(M0q=XRc());
return M0q},slp=function(k){var G;
k=(G=k.options)==null?void 0:G.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},xQA=function(k){var G;
return g.b(function(v){return v.j==1?g.N(v,k2(),2):(G=v.Z)?g.N(v,K4(G,"readwrite",function(Q){for(var A={},l=g.n(k),f=l.next(),S={};!f.done;S={iU:void 0,uc:void 0},f=l.next())S.iU=f.value,S.iU.entityKey&&slp(S.iU)&&(S.uc=g.XS(S.iU.payload),f=void 0,S.iU.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(f=function(O){return function(){return Rq(Q,O.iU.payload[O.uc],O.uc)}}(S)),S.iU.type==="ENTITY_MUTATION_TYPE_DELETE"&&(f=function(O){return function(){return Pg(Q,O.iU.entityKey)}}(S)),S.iU.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(f=function(O){return function(){return V0H(Q,O.iU.entityKey,O.iU.payload[O.uc],O.uc)}}(S)),f&&(A[S.iU.entityKey]=A[S.iU.entityKey]?A[S.iU.entityKey].then(f):f()));
return g.cK.all(Object.values(A))}),0):v.return()})},erq=function(k){var G;
return g.b(function(v){if(v.j==1){G=k.mutations;if(!G||G.length<=0)return v.return();if(g.Z_){var Q={type:"ENTITY_LOADED"};G!==void 0&&(Q.payload=G);g.Z_.dispatch(Q)}return g.N(v,xQA(G),2)}G.length=0;g.SH(v)})},LKH=function(k){return k!==void 0},nkA=function(k){var G=g.pu();
G=Object.assign({},G);k=Object.assign({},k);for(var v in G)k[v]?(G[v]!==4&&(G[v]=k[v]),delete k[v]):G[v]!==2&&(G[v]=4);Object.assign(G,k);g.aGb(G);JSON.stringify(G);return G},gkM=function(k){var G,v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,g.k_(),2);if(Q.j!=3)return(G=Q.Z)?g.N(Q,g.yJ(G),3):Q.return();v=Q.Z;return Q.return(g.ni(v,["index","media","captions"],{mode:"readwrite",O7:!0},function(A){var l=IDBKeyRange.bound(k+"|",k+"~");A=[A.objectStore("index").delete(l),A.objectStore("media").delete(l),A.objectStore("captions").delete(l)];return g.cK.all(A).then(function(){})}))})},CaH=function(){var k,G;
return g.b(function(v){if(v.j==1)return g.N(v,g.k_(),2);if(v.j!=3){k=v.Z;if(!k)throw g.dO("rvdfd");return g.N(v,g.yJ(k),3)}G=v.Z;return v.return(g.ni(G,["index","media"],{mode:"readwrite",O7:!0},function(Q){var A={};return g.zI(Q.objectStore("index"),{},function(l){var f=l.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),S=g.cK.resolve(void 0);if(f){var O=f[1];f=f[2];A[O]=A[O]||{};var Z;A[O][f]=g.mEz((Z=l.getValue())==null?void 0:Z.fmts)}else S=l.delete().then(function(){});
return g.cK.all([g.j9(l),S]).then(function(m){return g.n(m).next().value})}).then(function(){for(var l={},f=g.n(Object.keys(A)),S=f.next();!S.done;S=f.next()){S=S.value;
var O=A[S].v;l[S]=A[S].a&&O?1:2}var Z=nkA(l);return g.lQi(Q.objectStore("media"),{},function(m){var t=m.cursor.key.match(g.rK8);t&&l[t[1]]||Q.objectStore("media").delete(m.cursor.key);return g.KXp(m)}).then(function(){return Z})})}))})},NTg=function(k,G){var v,Q;
return g.b(function(A){if(A.j==1)return g.N(A,g.k_(),2);if(A.j!=3){v=A.Z;if(!v)throw g.dO("wct");return g.N(A,g.yJ(v),3)}Q=A.Z;return g.N(A,g.ni(Q,["captions"],{mode:"readwrite",O7:!0},function(l){var f=[];l=l.objectStore("captions");for(var S=0;S<G.length;S++){var O=g.gO(l,G[S],k+"|"+G[S].metadata.vss_id);f.push(O)}return g.cK.all(f)}),0)})},uLp=function(k){var G,v,Q;
return g.b(function(A){if(A.j==1)return G=IDBKeyRange.bound(k+"|",k+"~"),g.N(A,g.k_(),2);if(A.j!=3){v=A.Z;if(!v)throw g.dO("gactfv");return g.N(A,g.yJ(v),3)}Q=A.Z;return A.return(Q.getAll("captions",G))})},zrs=function(k){return g.b(function(G){g.IA(k,0);
return G.return(gkM(k))})},jlg=function(k){return{context:g.FI(),
videoIds:k}},bGg=function(k){return{context:g.FI(),
playlistIds:k}},pRg=function(k){return{context:g.FI(),
offlinePlaylistSyncChecks:k}},WKA=function(){this.j=new Map},ySs=function(){I5p||(I5p=new WKA);
return I5p},HGg=function(k,G){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:G,statusCode:void 0,csn:void 0,can:void 0}},TTA=function(k,G,v){if(!v){var Q=Q===void 0?!1:Q;
v=k.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!v||Q)v=g.VO(16),k.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",v)}k={flowNonce:v,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:G.eventType};G.metadata&&(k.flowMetadata=G.metadata);G.statusCode!==void 0&&(k.flowEventStatus=G.statusCode);G.csn&&(k.csn=G.csn);G.can&&(k.can=G.can);g.J7("flowEvent",k,void 0)},Rr5=function(k){var G,v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY;
return g.b(function(Lg){if(Lg.j==1)return g.N(Lg,K4(k,{mode:"readonly",O7:!0},function(Y){return Hg(Y,"playbackData").then(function(Gu){var Us=Gu.map(function(Ks){return Ks.transfer}).filter(function(Ks){return!!Ks}),ij=Gu.map(function(Ks){return Ks.offlineVideoPolicy}).filter(function(Ks){return!!Ks}),D8=Gu.filter(function(Ks){return!!Ks.key}).map(function(Ks){return g.Tz(g.Hb(Ks.key).entityId,"downloadStatusEntity")});
Us=Hg(Y,"transfer",Us);ij=Hg(Y,"offlineVideoPolicy",ij);D8=Hg(Y,"downloadStatusEntity",D8);var Os=Us.then(function(Ks){Ks=Ks.reduce(function(kp,MK){(MK==null?0:MK.offlineVideoStreams)&&kp.push.apply(kp,g.Db(MK.offlineVideoStreams));return kp},[]).filter(function(kp){return!!kp});
return Hg(Y,"offlineVideoStreams",Ks)});
return g.cK.all([Us,ij,Os,D8]).then(function(Ks){var kp=g.n(Ks);Ks=kp.next().value;var MK=kp.next().value;var M=kp.next().value;kp=kp.next().value;return[Gu,Ks,MK,M,kp]})})}),2);
if(Lg.j!=3)return G=Lg.Z,g.N(Lg,K4(k,{mode:"readonly",O7:!0},function(Y){return Hg(Y,"mainDownloadsListEntity").then(function(Gu){var Us,ij;return(ij=(Us=Gu[0])==null?void 0:Us.downloads)!=null?ij:[]})}),3);
v=Lg.Z;Q=g.n(G);A=Q.next().value;l=Q.next().value;f=Q.next().value;S=Q.next().value;O=Q.next().value;Z=A;m=l;t=f;J=S;r=O;V={};U={};h={};L={};e={};C=[];u=g.n(m);for(T=u.next();!T.done;T=u.next())(y=T.value)&&(V[y.key]=y);Ac=g.n(t);for(E=Ac.next();!E.done;E=Ac.next())(k3=E.value)&&(U[k3.key]=k3);iE=g.n(r);for(Zb=iE.next();!Zb.done;Zb=iE.next())(Ql=Zb.value)&&(h[Ql.key]=Ql);Y3=g.n(J);for(Gn=Y3.next();!Gn.done;Gn=Y3.next())(iA=Gn.value)&&(L[iA.key]=iA);fg=g.n(v);for(R7=fg.next();!R7.done;R7=fg.next())o7=
R7.value,Kg=void 0,e[(Kg=o7.videoItem)!=null?Kg:""]=!0,o7.videoItem&&(x=ng=void 0,wA=(x=(ng=g.Hb(o7.videoItem))==null?void 0:ng.entityId)!=null?x:"",C.push({externalVideoId:wA}));qw=Z.filter(function(Y){if(!Y||!Y.key||!Y.offlineVideoPolicy)return!1;Y=g.Hb(Y.key).entityId;Y=g.Tz(Y,"downloadStatusEntity");var Gu;return!(Y&&((Gu=h[Y])==null?void 0:Gu.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
SY=qw.map(function(Y){var Gu=V[Y.transfer],Us=[];if(Gu==null?0:Gu.offlineVideoStreams)for(var ij=g.n(Gu.offlineVideoStreams),D8=ij.next();!D8.done;D8=ij.next())(D8=L[D8.value])&&Us.push(D8);ij=U[Y.offlineVideoPolicy];D8=e;var Os=Y==null?void 0:Y.playerResponseTimestamp,Ks=g.Hb(ij.key).entityId;Y=g.Tz(Ks,"mainVideoEntity");if(ij.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var kp="OFFLINE_VIDEO_STATE_DISABLED";ij.expirationTimestamp&&Number(ij.expirationTimestamp)<Date.now()/1E3&&(kp="OFFLINE_VIDEO_STATE_EXPIRED")}else if(ij.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")kp="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Gu==null?void 0:Gu.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":kp="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":kp="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":kp="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":kp="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":kp="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":kp="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:kp="OFFLINE_VIDEO_STATE_UNKNOWN"}if(kp==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Gu==null?void 0:Gu.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":kp="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":kp="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":kp=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Ks={id:Ks,videoState:kp};if(Gu==null?0:Gu.cotn)Ks.cotn=Gu.cotn;if(Gu==null?0:Gu.maximumDownloadQuality)Ks.selectedVideoQuality=Gu==null?void 0:Gu.maximumDownloadQuality;if(Gu==null?0:Gu.lastProgressTimeMs)Ks.lastProgressTimeMs=Gu.lastProgressTimeMs;Os&&(Ks.playerResponseSavedTimeMs=String(Number(Os)*1E3));Gu=String;Os=0;Us=g.n(Us);for(kp=Us.next();!kp.done;kp=Us.next())if(kp=kp.value,kp.streamsProgress){kp=g.n(kp.streamsProgress);for(var MK=kp.next();!MK.done;MK=
kp.next()){var M=void 0;Os+=Number((M=MK.value.numBytesDownloaded)!=null?M:0)}}Ks.downloadedBytes=Gu(Os);Ks.selectedOfflineMode=D8[Y]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";ij.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Ks.offlinePlaybackDisabledReason=ij.offlinePlaybackDisabledReason);return Ks});
return Lg.return({offlineVideos:SY,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:C}}})})},PaA=function(){this.locks=navigator.locks},qWH=function(){try{var k=g.eH("ytglobal.locks_");
if(k)return k;var G;if(G=navigator){var v=navigator;G="locks"in v&&!!v.locks}if(G)return g.sA.localStorage&&g.sA.localStorage.getItem("noop"),k=new PaA,g.xp("ytglobal.locks_",k),k}catch(Q){}},G6=function(){},okp=function(){},KKg=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.Ka("CacheStorage get")},DQM=function(){return g.b(function(k){if(vm!==void 0)return k.return(vm);
vm=new Promise(function(G){var v;return g.b(function(Q){switch(Q.j){case 1:return g.OA(Q,2),g.N(Q,Qm.open("test-only"),4);case 4:return g.N(Q,Qm.delete("test-only"),5);case 5:g.mc(Q,3);break;case 2:if(v=g.t5(Q),v instanceof Error&&v.name==="SecurityError")return G(!1),Q.return();case 3:G("caches"in window),g.SH(Q)}})});
return k.return(vm)})},Ekg=function(){return g.b(function(k){if(k.j==1)return g.N(k,DQM(),2);
if(!k.Z)return k.return(void 0);FKg||(FKg=new okp);return k.return(FKg)})},Ag=function(k,G,v){g.nw(new g.zu("Woffle: "+k,v?{cotn:v}:""));
G instanceof Error&&g.nw(G)},kdH=function(k){var G;
return g.b(function(v){if(v.j==1)return g.N(v,Rr5(k),2);G=v.Z;g.J7("offlineStateSnapshot",G);g.SH(v)})},l6=function(k){g.W.call(this);
var G=this;this.api=k;this.hB={VRh:function(){return G.j},
uzg:function(){return G.Z}};
typeof g.sA.BroadcastChannel!=="undefined"&&(this.j=new g.sA.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Ka()),this.j.onmessage=this.Y.bind(this),this.Z=new g.sA.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Ka()),this.Z.onmessage=this.V.bind(this))},fU=function(k,G){k.api.yh("onOfflineOperationFailure",G);
var v;(v=k.j)==null||v.postMessage(G)},Gd7=function(k,G,v){var Q=this;
this.D=k;this.hs=G;this.visibility=v;this.S=this.W=this.G=this.Y=this.j=!1;this.V=new g.F3(function(){Q.H9()});
this.hB={Gr:function(){return Q.Z},
H9:function(){Q.H9()},
CGN:function(){return Q.V}};
this.visibility.subscribe("visibilitystatechange",function(){Q.JP()})},vwM=function(k){if(!k.Y&&!k.j){var G=qWH();
if(G){k.Y=!0;var v=g.Ka("OfflineLockManager");G.request("woffle_orchestration_leader:"+v,{},function(){var Q,A;return g.b(function(l){switch(l.j){case 1:return g.OA(l,2),k.Z=new g.mX,k.j=!0,k.Y=!1,g.N(l,k.D(),4);case 4:return g.N(l,k.Z.promise,5);case 5:g.mc(l,0);break;case 2:Q=g.t5(l),k.H9(),Q instanceof Error&&(A=Q,A.args=[{name:"WoLockManagerError",vX:Q.name}],g.eA(A)),g.SH(l)}})})}}},Q6c=function(k){k.j&&(k.S=!0,ap(k))},AkM=function(k,G){k.j&&(k.G=G,ap(k))},lZ5=function(k,G){k.j&&(k.W=G,ap(k))},
ap=function(k){k.W&&k.G&&k.S&&k.visibility.isBackground()?g.EU(k.V,6E4):k.V.stop()},i6=function(k){var G;
k.offlineDeleteReason=(G=k.offlineDeleteReason)!=null?G:"OFFLINE_DELETE_REASON_UNKNOWN";var v;k.offlineModeType=(v=k.offlineModeType)!=null?v:"OFFLINE_NOW";g.J7("offlineDeleteEvent",k)},Se=function(k,G){var v=G.videoId;
var Q=G.qf;G=G.offlineModeType;k.encryptedVideoId=v;k.cotn=Q==null?void 0:Q.cotn;k.offlineabilityFormatType=Q==null?void 0:Q.maximumDownloadQuality;var A;k.isRefresh=(A=Q==null?void 0:Q.isRefresh)!=null?A:!1;var l;k.softErrorCount=(l=Q==null?void 0:Q.transferRetryCount)!=null?l:0;k.offlineModeType=G!=null?G:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.nw(Error("Woffle unknown transfer status"));
g.J7("offlineTransferStatusChanged",k)},fZn=function(k){Se({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},k)},aZA=function(k,G,v,Q){Q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!Q};G&&v&&(G=Math.floor(G/1024).toFixed(),v=Math.floor(v/1024).toFixed(),Q.alreadyDownloadedKbytes=G,Q.totalFetchedKbytes=G,Q.totalContentKbytes=v);Se(Q,k)},i0n=function(k){Se({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},k)},Sws=function(k){Se({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},O05=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Og=function(k){var G,v,Q;
return((Q=(G=k.actionMetadata)==null?void 0:(v=G.retryScheduleIntervalsInSeconds)==null?void 0:v.length)!=null?Q:0)>0},Za=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},me=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},tg=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},Z0A=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},
$2=function(k,G,v,Q,A){A=A===void 0?!1:A;
var l,f,S,O,Z,m;return g.b(function(t){if(t.j==1)return l=g.Tz(k,G),f=g.Tz(k,"downloadStatusEntity"),g.N(t,K4(v,{mode:"readonly",O7:!0},function(J){return g.cK.all([yT(J,l,G),yT(J,f,"downloadStatusEntity")])}),2);
S=t.Z;O=S.length?S[0]:void 0;if(!O)return t.As(0);Z=mpn;if(m=S.length>1?S[1]:void 0){if(m.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!A)return t.return();m.downloadState=Q}else m={key:f,downloadState:Q};g.jA(O,Z,m);return g.N(t,K4(v,{mode:"readwrite",O7:!0},function(J){return g.cK.all([Rq(J,O,G),Rq(J,m,"downloadStatusEntity")])}),0)})},Jg=function(k,G){return k.actionType===G.actionType&&k.entityKey===G.entityKey},rv=function(k,G){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!==
"TRANSFER_STATE_FAILED"){var v=g.Hb(k.key).entityId;
Se({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:v,qf:k,offlineModeType:G})}},Vm=function(k){if(!k||!k.thumbnails)return[];
var G=[];k=g.n(k.thumbnails);for(var v=k.next();!v.done;v=k.next())v=v.value,v.url&&G.push(v.url);return G},tZM=function(k,G,v){v=v===void 0?[]:v;
var Q,A,l,f,S,O,Z,m,t,J,r,V,U;return g.b(function(h){if(h.j==1)return v.length?g.N(h,E2(k,G),2):h.return([]);Q=h.Z;A=new Set;l=g.n(Q);for(f=l.next();!f.done;f=l.next())if(S=f.value,O=S.id||S.key)Z=g.Hb(O).entityId,A.add(Z);m=[];t=g.n(v);for(J=t.next();!J.done;J=t.next())r=J.value,V=r.offlineVideoData,U=void 0,((U=V)==null?0:U.videoId)&&!A.has(V.videoId)&&m.push(r);return h.return(m)})},$pA=function(k,G,v){return new g.G_(k,{cotn:G,
raw_player_response:v,download_media:!0,start:Infinity,disable_watch_next:!0})},Jkg=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Bm=function(k,G,v,Q,A,l,f,S,O,Z,m){this.entityType=k;
this.actionId=G;this.action=v;this.parentActionId=Q;this.rootActionId=A===void 0?G:A;this.childActionIds=l;this.prereqActionId=f;this.postreqActionIds=S;this.hasChildActionFailed=Z;this.retryScheduleIndex=0;this.j=m||Date.now();this.retryScheduleIndex=O||0},wv=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var G=g.Hb(k.key),v=g.Hb(k.actionProto.entityKey);return new Bm(v.entityType,G.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},dv=function(k){return{key:g.Tz(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.j/1E3).toFixed()}},rkn=function(){var k;
return g.b(function(G){return G.j==1?g.N(G,Ekg(),2):(k=G.Z)?G.return(k.delete("yt-player-local-img")):G.return(!0)})},Ug=function(k){var G,v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,Ekg(),2);if(Q.j!=3){G=Q.Z;if(!G)throw Error("Cache API not supported");return k.length?g.N(Q,G.open("yt-player-local-img"),3):Q.return()}v=Q.Z;return g.N(Q,Promise.all(k.map(function(A){return v.delete(A)})),0)})},cm=function(k){var G,v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,Ekg(),2);if(Q.j!=3){G=Q.Z;if(!G)throw Error("Cache API not supported");return k.length?g.N(Q,G.open("yt-player-local-img"),3):Q.return()}v=Q.Z;return g.N(Q,v.addAll(k),0)})},hg=function(k,G,v,Q,A){var l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg;
return g.b(function(ng){switch(ng.j){case 1:return l=g.Tz(k,"mainVideoEntity"),f=g.Tz(k,"ytMainChannelEntity"),S=g.Tz(k,"transfer"),O=g.Tz(k,"videoDownloadContextEntity"),g.N(ng,K4(G,{mode:"readonly",O7:!0},function(x){return g.cK.all([yT(x,l,"mainVideoEntity"),yT(x,f,"ytMainChannelEntity"),yT(x,S,"transfer"),yT(x,O,"videoDownloadContextEntity"),Hg(x,"ytMainChannelEntity"),Hg(x,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=ng.Z;m=g.n(Z);t=m.next().value;J=m.next().value;r=m.next().value;V=m.next().value;U=m.next().value;h=m.next().value;L=t;e=J;C=r;u=V;T=U;y=h;if(!L&&!e){ng.As(3);break}Ac=L?Vm(L.thumbnail):[];if(!e){E=[];ng.As(4);break}return g.N(ng,VZ5(e,T),5);case 5:E=ng.Z;case 4:return k3=E,g.N(ng,Ug(Ac.concat(k3)),3);case 3:iE=[];Zb=g.Tz(k,"downloadStatusEntity");Ql=g.n(y);for(Y3=Ql.next();!Y3.done;Y3=Ql.next())Gn=Y3.value,iA=g.Hb(Gn.key).entityId,fg=wv(Gn),R7=g.Hb(fg.action.entityKey).entityId,iA!==k&&
R7!==k||Jg(v,Gn.actionProto)||iE.push(Gn.key);return g.N(ng,K4(G,{mode:"readwrite",O7:!0},function(x){var wA=iE.map(function(qw){return Pg(x,qw)});
wA.push(Pg(x,l,{Fl:!0}));wA.push(Pg(x,Zb,{Fl:!0}));return g.cK.all(wA)}),7);
case 7:Kg=(o7=u)==null?void 0:o7.offlineModeType,A&&(i6(A),A.offlineModeType&&(Kg=A.offlineModeType)),rv(C,Kg),fU(Q,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.SH(ng)}})},dpn=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY,Lg,Y,Gu,Us,ij,D8,Os,Ks,kp,MK,M,c,X;
return g.b(function(z){switch(z.j){case 1:return A=g.Tz(k,"mainPlaylistEntity"),l=g.Tz(k,"ytMainChannelEntity"),g.N(z,K4(G,{mode:"readonly",O7:!0},function(q){return g.cK.all([yT(q,A,"mainPlaylistEntity"),yT(q,l,"ytMainChannelEntity"),Hg(q,"mainPlaylistEntity"),Hg(q,"mainDownloadsListEntity"),Hg(q,"ytMainChannelEntity"),Hg(q,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=z.Z;S=g.n(f);O=S.next().value;Z=S.next().value;m=S.next().value;t=S.next().value;J=S.next().value;r=S.next().value;V=O;U=Z;h=m;L=t;e=J;C=r;if(!V&&!U){z.As(3);break}u=V?BiA(V):[];if(!U){T=[];z.As(4);break}return g.N(z,VZ5(U,e),5);case 5:T=z.Z;case 4:return y=T,g.N(z,Ug(u.concat(y)),3);case 3:Ac=[];E=new Map;if(!V){z.As(7);break}return g.N(z,wjM(V,h,L),8);case 8:Ac=z.Z;k3=g.n(Ac);for(iE=k3.next();!iE.done;iE=k3.next())Zb=iE.value,E.set(Zb,{videoId:Zb,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.N(z,K4(G,{mode:"readonly",O7:!0},function(q){return g.cK.all([Hg(q,"transfer"),Hg(q,"videoDownloadContextEntity")])}),9);
case 9:Ql=z.Z;Y3=g.n(Ql);Gn=Y3.next().value;iA=Y3.next().value;fg=Gn;R7=iA;o7=g.n(fg);for(Kg=o7.next();!Kg.done;Kg=o7.next())ng=Kg.value,x=g.Hb(ng.key).entityId,(wA=E.get(x))&&ng&&(wA.cotn=ng.cotn);qw=g.n(R7);for(SY=qw.next();!SY.done;SY=qw.next())Lg=SY.value,Y=g.Hb(Lg.key).entityId,(Gu=E.get(Y))&&Lg&&(Gu.offlineModeType=Lg.offlineModeType);case 7:Us=[];ij=g.n(C);for(D8=ij.next();!D8.done;D8=ij.next())Os=D8.value,Ks=g.Hb(Os.key).entityId,kp=wv(Os),Ks!==k&&kp.rootActionId!==k||Jg(v,Os.actionProto)||
Us.push(Os.key);MK=g.Tz(k,"mainPlaylistEntity");return g.N(z,K4(G,{mode:"readwrite",O7:!0},function(q){var a7=Us.map(function(D){return Pg(q,D)});
a7.push(Pg(q,MK,{Fl:!0}));return g.cK.all(a7)}),10);
case 10:if(!V){z.As(0);break}Ac.reverse();if(!Ac){z.As(0);break}M=g.n(Ac);c=M.next();case 13:if(c.done){z.As(0);break}X=c.value;return g.N(z,hg(X,G,v,Q,E.get(X)),14);case 14:c=M.next(),z.As(13)}})},ckn=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J;
return g.b(function(r){if(r.j==1)return A=g.Tz("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),l=new Map,g.N(r,K4(k,{mode:"readwrite",O7:!0},function(V){var U=Hg(V,"transfer"),h=Hg(V,"offlineOrchestrationActionWrapperEntity"),L=Hg(V,"videoDownloadContextEntity"),e=yT(V,A,"mainDownloadsListEntity");return g.cK.all([U,h,L,e]).then(function(C){C=g.n(C);var u=C.next().value;var T=C.next().value;var y=C.next().value;var Ac=C.next().value;C=Up7.map(function(k3){return rSs(V,k3)});
T=g.n(T);for(var E=T.next();!E.done;E=T.next())E=E.value,Jg(G,E.actionProto)||C.push(Pg(V,E.key,{Fl:!0}));Ac&&(Ac.downloads=[],C.push(Rq(V,Ac,"mainDownloadsListEntity")));if(y)for(y=g.n(y),Ac=y.next();!Ac.done;Ac=y.next())Ac=Ac.value,T=g.Hb(Ac.key).entityId,T=g.Tz(T,"transfer"),l.set(T,Ac.offlineModeType);return g.cK.all(C).then(function(){return u})})}),2);
f=r.Z;S=g.n(f);for(O=S.next();!O.done;O=S.next())Z=O.value,rv(Z,l.get(Z.key)),m=g.Hb(Z.key).entityId,t={videoId:m,offlineDeleteReason:Q,cotn:Z.cotn,offlineModeType:l.get(Z.key)},i6(t),J=g.Tz(m,"mainVideoEntity"),fU(v,{entityKey:J,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.N(r,rkn(),0)})},BiA=function(k,G){var v=[];
if(k.thumbnailStyleData){k=g.n(k.thumbnailStyleData);for(var Q=k.next();!Q.done;Q=k.next()){var A=void 0,l=void 0,f=void 0;v=v.concat(Vm((A=Q.value)==null?void 0:(l=A.value)==null?void 0:(f=l.collageThumbnail)==null?void 0:f.coverThumbnail))}}G=Vm(G);return v.concat(G)},wjM=function(k,G,v){var Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3;
return g.b(function(iE){Q=[];A=new Set;if(v.length)for(l=g.n(v),f=l.next();!f.done;f=l.next())if(S=f.value,O=void 0,(O=S.downloads)==null?0:O.length)for(Z=g.n(S.downloads),m=Z.next();!m.done;m=Z.next())t=m.value,t.videoItem&&(J=g.Hb(t.videoItem).entityId,A.add(J));if(k.videos){r=g.n(k.videos);for(V=r.next();!V.done;V=r.next())U=V.value,h=JSON.parse(g.Hb(U).entityId),h.videoId&&!A.has(h.videoId)&&Q.push(h.videoId);L=g.n(G);for(e=L.next();!e.done;e=L.next())if(C=e.value,C.key!==k.key&&(u=C.videos))for(T=
g.n(u),y=T.next();!y.done;y=T.next())Ac=y.value,E=JSON.parse(g.Hb(Ac).entityId),E.videoId&&(k3=Q.indexOf(E.videoId),k3!==-1&&Q.splice(k3,1))}return iE.return(Q)})},VZ5=function(k,G){var v,Q,A,l,f,S,O,Z;
return g.b(function(m){v=Vm(k.avatar);Q=g.n(G);for(A=Q.next();!A.done;A=Q.next())if(l=A.value,l.id!==k.id)for(f=g.n(Vm(l.avatar)),S=f.next();!S.done;S=f.next())O=S.value,Z=v.indexOf(O),Z!==-1&&v.splice(Z,1);return m.return(v)})},hkp=function(k){var G;
return g.b(function(v){G=g.w(k.frameworkUpdates,Y2);return k.frameworkUpdates&&G?g.N(v,erq(G),0):v.return()})},XjA=function(k){var G;
if((G=k.onResponseReceivedActions)!=null&&G.length){var v;k=(v=g.w(g.w(k.onResponseReceivedActions[0],Yww),g.MYM))==null?void 0:v.actions;if(k!=null&&k.length)return k}},MZq=function(k){var G,v,Q;
return g.b(function(A){if(A.j==1)return k?g.N(A,F0(k,g.zv,"mainDownloadsListEntity"),2):A.return([]);G=A.Z;return((v=G)==null?0:(Q=v.downloads)==null?0:Q.length)?A.return(G.downloads.map(function(l){var f;return(f=l.videoItem)!=null?f:""})):A.return([])})},xpA=function(k,G){var v;
return g.b(function(Q){return Q.j==1?g.N(Q,s6p(k,G),2):(v=Q.Z)?g.N(Q,K4(k,{mode:"readwrite",O7:!0},function(A){var l=[Rq(A,v.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];v.mainDownloadsListEntity&&l.push(Rq(A,v.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.cK.all(l)}),0):Q.As(0)})},s6p=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C;
return g.b(function(u){if(u.j==1)return v=g.Tz("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.Tz("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.N(u,K4(k,{mode:"readonly",O7:!0},function(T){return g.cK.all([yT(T,v,"mainDownloadsLibraryEntity"),yT(T,Q,"mainDownloadsListEntity")])}),2);
A=u.Z;l=g.n(A);f=l.next().value;S=l.next().value;O=f;Z=S;O||(O={id:v});m=g.n(G);for(t=m.next();!t.done;t=m.next())if(J=t.value,J===g.zv){if(O.smartDownloadsList)return u.return();O.smartDownloadsList=J}else if(r=g.Hb(J).entityType,V={},r==="mainPlaylistEntity"?V.playlistItem=J:r==="mainVideoEntity"&&(V.videoItem=J),!g.Ct(V)){U=void 0;if((U=Z)==null?0:U.downloads){h=!1;L=g.n(Z.downloads);for(e=L.next();!e.done;e=L.next())if(C=e.value,C.playlistItem===J||C.videoItem===J){h=!0;break}h||Z.downloads.push(V)}else Z=
{id:Q,downloads:[V]};O.downloadsList=Q}return u.return({mainDownloadsLibraryEntity:O,mainDownloadsListEntity:Z})})},ekg=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h;
return g.b(function(L){if(L.j==1)return v=g.Tz("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.Tz("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.N(L,K4(k,{mode:"readonly",O7:!0},function(e){return g.cK.all([yT(e,v,"mainDownloadsLibraryEntity"),yT(e,Q,"mainDownloadsListEntity"),yT(e,g.zv,"mainDownloadsListEntity")])}),2);
A=L.Z;l=g.n(A);f=l.next().value;S=l.next().value;O=l.next().value;Z=f;m=S;t=O;if(!Z)return L.As(0);if(G===g.zv&&((J=t)==null?0:J.downloads))t.downloads=[];else if((r=m)==null?0:r.downloads)for(V=g.Hb(G).entityType,U=0;U<m.downloads.length;U++)if(h=m.downloads[U],V==="mainVideoEntity"&&h.videoItem===G){m.downloads.splice(U,1);break}else if(V==="mainPlaylistEntity"&&h.playlistItem===G){m.downloads.splice(U,1);break}return g.N(L,K4(k,{mode:"readwrite",O7:!0},function(e){var C=[Rq(e,Z,"mainDownloadsLibraryEntity")];
m&&C.push(Rq(e,m,"mainDownloadsListEntity"));t&&C.push(Rq(e,t,"mainDownloadsListEntity"));return g.cK.all(C)}),0)})},XU=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J;
return g.b(function(r){if(r.j==1)return v=g.Tz(G,"transfer"),Q=g.Tz(G,"videoDownloadContextEntity"),g.N(r,K4(k,{mode:"readonly",O7:!0},function(V){return g.cK.all([yT(V,v,"transfer"),yT(V,Q,"videoDownloadContextEntity")])}),2);
A=r.Z;l=g.n(A);f=l.next().value;S=l.next().value;O=f;Z=S;J={videoId:G,cotn:(m=O)==null?void 0:m.cotn,offlineModeType:(t=Z)==null?void 0:t.offlineModeType};return r.return(J)})},MP=function(k,G,v,Q,A){var l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E;
return g.b(function(k3){switch(k3.j){case 1:return l=g.Tz(k,"musicTrack"),f=g.Tz(k,"transfer"),g.N(k3,K4(G,{mode:"readonly",O7:!0},function(iE){return g.cK.all([yT(iE,l,"musicTrack"),yT(iE,f,"transfer"),Hg(iE,"musicTrack"),Hg(iE,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=k3.Z;O=g.n(S);Z=O.next().value;m=O.next().value;t=O.next().value;J=O.next().value;r=Z;V=m;U=t;h=J;if(!r){k3.As(3);break}return g.N(k3,Lqg(r,U),4);case 4:return L=k3.Z,g.N(k3,Ug(L),3);case 3:e=[];C=g.n(h);for(u=C.next();!u.done;u=C.next())T=u.value,y=g.Hb(T.key).entityId,Ac=wv(T),E=g.Hb(Ac.action.entityKey).entityId,y!==k&&E!==k||Jg(v,T.actionProto)||e.push(T.key);return g.N(k3,K4(G,{mode:"readwrite",O7:!0},function(iE){var Zb=e.map(function(Ql){return Pg(iE,Ql)});
Zb.push(Pg(iE,l,{Fl:!0}));return g.cK.all(Zb)}),6);
case 6:rv(V),A&&i6(A),fU(Q,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.SH(k3)}})},sg=function(k,G,v,Q,A){var l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY;
return g.b(function(Lg){switch(Lg.j){case 1:return l=g.Tz(k,G),f=g.Tz("music_downloads_library_id","musicDownloadsLibraryEntity"),g.N(Lg,K4(v,{mode:"readonly",O7:!0},function(Y){return g.cK.all([yT(Y,l,G),yT(Y,f,"musicDownloadsLibraryEntity"),Hg(Y,G),Hg(Y,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=Lg.Z;O=g.n(S);Z=O.next().value;m=O.next().value;t=O.next().value;J=O.next().value;r=Z;V=m;U=t;h=J;if(!r){Lg.As(3);break}return g.N(Lg,Lqg(r,U),4);case 4:return L=Lg.Z,g.N(Lg,Ug(L),3);case 3:e=[];C=new Map;if(!r){Lg.As(6);break}return g.N(Lg,nwA(r,U,V),7);case 7:e=Lg.Z;u=g.n(e);for(T=u.next();!T.done;T=u.next())y=T.value,Ac=g.Hb(y).entityId,C.set(Ac,{videoId:Ac,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.N(Lg,E2(v,"transfer"),8);case 8:for(E=Lg.Z,
k3=g.n(E),iE=k3.next();!iE.done;iE=k3.next())Zb=iE.value,Ql=g.Hb(Zb.key).entityId,(Y3=C.get(Ql))&&Zb&&(Y3.cotn=Zb.cotn);case 6:Gn=[];iA=g.n(h);for(fg=iA.next();!fg.done;fg=iA.next())R7=fg.value,o7=g.Hb(R7.key).entityId,Kg=wv(R7),o7!==k&&Kg.rootActionId!==k||Jg(Q,R7.actionProto)||Gn.push(R7.key);ng=g.Tz(k,G);return g.N(Lg,K4(v,{mode:"readwrite",O7:!0},function(Y){var Gu=Gn.map(function(Us){return Pg(Y,Us)});
Gu.push(Pg(Y,ng,{Fl:!0}));return g.cK.all(Gu)}),9);
case 9:if(!r){Lg.As(0);break}e.reverse();if(!e.length){Lg.As(0);break}x=g.n(e);wA=x.next();case 12:if(wA.done){Lg.As(0);break}qw=wA.value;SY=g.Hb(qw).entityId;if(!SY){Lg.As(13);break}return g.N(Lg,MP(SY,v,Q,A,C.get(SY)),13);case 13:wA=x.next(),Lg.As(12)}})},x2=function(k,G,v){var Q,A,l,f,S,O,Z;
return g.b(function(m){if(m.j==1)return g.N(m,K4(k,{mode:"readwrite",O7:!0},function(t){var J=Hg(t,"transfer"),r=Hg(t,"offlineOrchestrationActionWrapperEntity");return g.cK.all([J,r]).then(function(V){V=g.n(V);var U=V.next().value;var h=V.next().value;V=gwH.map(function(u){return rSs(t,u)});
h=g.n(h);for(var L=h.next();!L.done;L=h.next()){L=L.value;var e=g.Hb(L.actionProto.entityKey).entityType==="musicTrack",C=L.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Jg(G,L.actionProto)||e&&(!e||C)||V.push(Pg(t,L.key,{Fl:!0}))}return g.cK.all(V).then(function(){return U})})}),2);
Q=m.Z;A=g.n(Q);for(l=A.next();!l.done;l=A.next())f=l.value,rv(f),S=g.Hb(f.key).entityId,O={videoId:S,offlineDeleteReason:void 0,cotn:f.cotn},i6(O),Z=g.Tz(S,"musicTrack"),fU(v,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.N(m,rkn(),0)})},C9A=function(k){for(var G,v=g.n(k.additionalMetadatas),Q=v.next();!Q.done;Q=v.next())Q=Q.value,Q.offlineMusicVideoData&&(G=Q.offlineMusicVideoData);
var A,l,f,S,O;return{id:g.Tz(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(A=G)==null?void 0:A.releaseTitle,musicVideoType:(l=G)==null?void 0:l.musicVideoType,contentRating:{explicitType:(f=G)==null?void 0:f.explicitType},artistNames:((S=G)==null?void 0:S.byline)||((O=G)==null?void 0:O.channelName),downloadMetadata:g.Tz(k.videoId,"musicTrackDownloadMetadataEntity")}},nwA=function(k,G,v){var Q,A,l,f,S,O,
Z,m,t,J,r,V,U,h,L,e,C,u;
return g.b(function(T){Q=[];A=new Set;if((l=v)==null?0:(f=l.downloadedTracks)==null?0:f.length)for(S=g.n(v.downloadedTracks),O=S.next();!O.done;O=S.next())Z=O.value,A.add(Z);if(k.tracks){m=g.n(k.tracks);for(t=m.next();!t.done;t=m.next())J=t.value,A.has(J)||Q.push(J);r=g.n(G);for(V=r.next();!V.done;V=r.next())if(U=V.value,U.id!==k.id&&(h=U.tracks))for(L=g.n(h),e=L.next();!e.done;e=L.next())C=e.value,u=Q.indexOf(C),u!==-1&&Q.splice(u,1)}return T.return(Q)})},Lqg=function(k,G){var v,Q,A,l,f,S,O,Z;
return g.b(function(m){v=Vm(k.thumbnailDetails);Q=g.n(G);for(A=Q.next();!A.done;A=Q.next())if(l=A.value,l.id!==k.id)for(f=g.n(Vm(l.thumbnailDetails)),S=f.next();!S.done;S=f.next())O=S.value,Z=v.indexOf(O),Z!==-1&&v.splice(Z,1);return m.return(v)})},Nic=function(k,G){var v,Q,A,l,f,S,O,Z,m;
return g.b(function(t){if(t.j==1)return v=g.Tz("music_downloads_library_id","musicDownloadsLibraryEntity"),g.N(t,F0(k,v,"musicDownloadsLibraryEntity"),2);(Q=t.Z)||(Q={id:v});A=g.Hb(G).entityType;A==="musicTrack"?(l=Q.downloadedTracks)!=null&&l.includes(G)||(Q.downloadedTracks=((f=Q.downloadedTracks)!=null?f:[]).concat(G)):A==="musicPlaylist"?(S=Q.downloadedPlaylists)!=null&&S.includes(G)||(Q.downloadedPlaylists=((O=Q.downloadedPlaylists)!=null?O:[]).concat(G)):A!=="musicAlbumRelease"||(Z=Q.downloadedAlbumReleases)!=
null&&Z.includes(G)||(Q.downloadedAlbumReleases=((m=Q.downloadedAlbumReleases)!=null?m:[]).concat(G));return g.N(t,Dg(k,Q,"musicDownloadsLibraryEntity"),0)})},u6c=function(k,G){var v,Q,A,l,f,S,O;
return g.b(function(Z){if(Z.j==1)return v=g.Tz("music_downloads_library_id","musicDownloadsLibraryEntity"),g.N(Z,F0(k,v,"musicDownloadsLibraryEntity"),2);Q=Z.Z;if(!Q)return Z.As(0);A=g.Hb(G).entityType;A==="musicTrack"?l=Q.downloadedTracks:A==="musicPlaylist"&&(l=Q.downloadedPlaylists);if((f=l)==null?0:f.length)for(S=0;S<l.length;S++)if(O=l[S],O===G){l.splice(S,1);break}return g.N(Z,Dg(k,Q,"musicDownloadsLibraryEntity"),0)})},zkH=function(k){var G=k.videos;
k=[];var v=[];if(G){G=g.n(G);for(var Q=G.next();!Q.done;Q=G.next()){var A=Q.value.offlineVideoData.videoId;Q=g.Tz(A,"musicTrack");A=g.Tz(A,"musicTrackDownloadMetadataEntity");k.push(Q);v.push(A)}}return{Qt:k,p$:v}},ee=function(k,G,v){G={track:C9A(G)};
v&&(G.playlistId=v);if(k=g.w(k.actionMetadata,j6A))G.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:G}},pj7=function(k){var G,v,Q,A,l,f,S,O;
return g.b(function(Z){switch(Z.j){case 1:return G=g.Kq(),v=jlg(k),Q=g.G7(b0A),g.OA(Z,2),l={Np:!0},g.N(Z,g.ju(G,v,Q,void 0,l),4);case 4:A=Z.Z;g.mc(Z,3);break;case 2:f=g.t5(Z);if(f instanceof g.Px)throw S="GetOffline network manager error: "+f.message,Ag(S,f),Error(S);Ag("GetOffline fetch request error",f);throw Error("GetOffline fetch request error");case 3:O=LU(A);if(!A)throw Ag("Network request failed"),Error("Network request failed");if(O!==void 0)nU(O);else if(!A.videos||!A.videos.length)throw Ag("No data"),
Error("No data");return Z.return(A.videos.map(function(m){return m.offlineVideoData}))}})},WqA=function(k){var G,v,Q,A,l,f,S,O;
return g.b(function(Z){switch(Z.j){case 1:return G=g.Kq(),v=bGg(k),Q=g.G7(b0A),g.OA(Z,2),l={Np:!0},g.N(Z,g.ju(G,v,Q,void 0,l),4);case 4:A=Z.Z;g.mc(Z,3);break;case 2:f=g.t5(Z);if(f instanceof g.Px)throw S="GetOffline network manager error for playlist: "+f.message,Ag(S,f),Error(S);Ag("GetOffline fetch request error for playlist",f);throw Error("GetOffline fetch request error for playlist");case 3:O=LU(A);if(!A)throw Ag("Network request failed for playlist"),Error("Network request failed for playlist");
if(O!==void 0)nU(O,"playlist");else if(!A.playlists||!A.playlists.length)throw Ag("No data for playlist"),Error("No data for playlist");return Z.return(A.playlists.map(function(m){return m.offlinePlaylistData}))}})},ykA=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7;
return g.b(function(o7){switch(o7.j){case 1:return g.N(o7,k2(),2);case 2:A=o7.Z;if(!A)return o7.return([]);l=[];if((f=Q)==null?0:f.length){l=Q;o7.As(3);break}return g.N(o7,E2(A,"mainPlaylistEntity"),4);case 4:l=o7.Z;case 3:if(!l.length)return o7.return([]);S=[];O=Date.now()/1E3;Z=g.n(l);m=Z.next();case 5:if(m.done)return S.length?g.N(o7,IZn(S),10):o7.return([]);t=m.value;if(!t.downloadState){J=void 0;o7.As(8);break}return g.N(o7,F0(A,t.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:J=
o7.Z;case 8:r=J;V=void 0;h=(U=(V=t)==null?void 0:V.entityMetadata)&&U.nextAutoRefreshIntervalSeconds?Number(U.nextAutoRefreshIntervalSeconds):NaN;L=Number.isNaN(h)?k:h;C=e=void 0;u=((e=r)==null?0:e.lastSyncedTimestampMillis)?Number((C=r)==null?void 0:C.lastSyncedTimestampMillis)/1E3:0;y=T=void 0;Ac=((T=r)==null?0:T.addedTimestampMillis)?Number((y=r)==null?void 0:y.addedTimestampMillis)/1E3:0;if(v||!U||u+L<=O){E=[];k3=void 0;if((k3=t.videos)==null?0:k3.length)for(iE=g.n(t.videos),Zb=iE.next();!Zb.done;Zb=
iE.next())Ql=Zb.value,Y3=JSON.parse(g.Hb(Ql).entityId),Y3.videoId&&E.push(Y3.videoId);Gn="0";U&&(iA=void 0,Gn=String(Number((iA=U.offlineLastModifiedTimestampSeconds)!=null?iA:0).toFixed()));fg={playlistId:t.playlistId,videoIds:E,offlineLastModifiedTimestamp:Gn,autoSync:G,offlineDateAddedTimestamp:String(Ac.toFixed())};S.push(fg)}m=Z.next();o7.As(5);break;case 10:return R7=o7.Z,o7.return(R7)}})},H05=function(){var k,G,v,Q,A;
return g.b(function(l){if(l.j==1)return g.N(l,k2(),2);if(l.j!=3)return(k=l.Z)?g.N(l,E2(k,"refresh"),3):l.return(!1);G=l.Z;if((v=G[0])==null||!v.refreshTime)return l.return(!1);Q=Number(G[0].refreshTime);A=Date.now()/1E3;return l.return(isFinite(Q)&&A>=Q)})},Rk7=function(k,G){var v,Q,A;
return g.b(function(l){switch(l.j){case 1:return g.OA(l,2),g.N(l,Tip(k,G),4);case 4:return Q=l.Z,g.N(l,hkp(Q),5);case 5:v=XjA(Q);g.mc(l,3);break;case 2:A=g.t5(l),Ag("getAndProcessSmartDownloadsResponse request or processing error",A);case 3:return l.return(v)}})},P9H=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7;
return g.b(function(o7){switch(o7.j){case 1:return g.N(o7,k2(),2);case 2:A=o7.Z;if(!A)return o7.return([]);l=[];if((f=Q)==null?0:f.length){l=Q;o7.As(3);break}return g.N(o7,E2(A,"musicPlaylist"),4);case 4:l=o7.Z;case 3:if(!l.length)return o7.return([]);S=[];O=Date.now()/1E3;Z=g.n(l);m=Z.next();case 5:if(m.done)return S.length?g.N(o7,IZn(S),10):o7.return([]);t=m.value;J=void 0;V=(r=(J=t)==null?void 0:J.entityMetadata)&&r.nextAutoRefreshIntervalSeconds?Number(r.nextAutoRefreshIntervalSeconds):NaN;U=
Number.isNaN(V)?k:V;L=h=0;e="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!t.downloadMetadata){o7.As(8);break}return g.N(o7,F0(A,t.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:C=o7.Z,T=u=void 0,h=Number((T=(u=C)==null?void 0:u.addedTimestampMillis)!=null?T:"0")/1E3,Ac=y=void 0,L=Number((Ac=(y=C)==null?void 0:y.lastModifiedTimestampMillis)!=null?Ac:"0")/1E3,k3=E=void 0,e=(k3=(E=C)==null?void 0:E.syncState)!=null?k3:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:iE=void 0;if(v||e!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!r||Number((iE=r.lastSyncedTimestampSeconds)!=null?iE:0)+U<=O){Zb=[];Ql=void 0;if((Ql=t.tracks)==null?0:Ql.length)for(Y3=g.n(t.tracks),Gn=Y3.next();!Gn.done;Gn=Y3.next())iA=Gn.value,Zb.push(g.Hb(iA).entityId);fg={playlistId:t.playlistId,videoIds:Zb,offlineLastModifiedTimestamp:String(L.toFixed()),autoSync:G,offlineDateAddedTimestamp:String(h.toFixed())};S.push(fg)}m=Z.next();o7.As(5);break;case 10:return R7=o7.Z,o7.return(R7)}})},Tip=function(k,G){var v,Q,A,l,f,S,O,Z,m,t;
return g.b(function(J){switch(J.j){case 1:return v=g.Kq(),g.N(J,k2(),2);case 2:Q=J.Z;if(!Q){J.As(3);break}return g.N(J,Rr5(Q),4);case 4:A=J.Z;case 3:var r=A;l={context:g.FI(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:r,clientStateRequestData:{preferredFormatType:G}}}};f=g.G7(qwg);g.OA(J,5);O={Np:!0};return g.N(J,g.ju(v,l,f,void 0,O),7);case 7:S=J.Z;g.mc(J,6);break;case 5:Z=g.t5(J);if(Z instanceof g.Px)throw m=
"DPS network manager error for smart downloads: "+Z.message,Ag(m,Z),Error(m);Ag("DPS fetch request error for smart downloads",Z);throw Error("DPS fetch request error for smart downloads");case 6:t=LU(S);if(S)t!==void 0&&nU(t,"smart downloads");else throw Ag("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return J.return(S)}})},KqA=function(k,G){var v,Q,A,l,f,S,O,Z;
return g.b(function(m){switch(m.j){case 1:return v=g.Kq(),Q={context:g.FI(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:G},A=g.G7(own),g.OA(m,2),f={Np:!0},g.N(m,g.ju(v,Q,A,void 0,f),4);case 4:l=m.Z;g.mc(m,3);break;case 2:S=g.t5(m);if(S instanceof g.Px)throw O="VPPS network manager error: "+S.message,Ag(O,S),Error(O);Ag("VPPS fetch request error",S);throw Error("VPPS fetch request error");case 3:Z=LU(l);if(l)Z!==void 0&&nU(Z,"position sync");else throw Ag("Network request failed for position sync"),
Error("Network request failed for position sync");return m.return(l)}})},FqM=function(k,G,v){var Q,A,l,f,S,O,Z,m;
return g.b(function(t){switch(t.j){case 1:Q=g.Kq();var J=v.refreshData,r=v.isEnqueuedForExpiredStreamUrlRefetch,V=v.v8,U=v.offlineSourceData,h=v.mediaCapabilities,L={entityKey:k};J&&(L.refreshData=J);r&&(L.isExpiredStreamUrlRefetch=r);V&&(L.downloadParameters=V);U&&(L.offlineSourceData=U);J={context:g.Sw(G),signatureTimestamp:20397,videos:[L]};h&&(J.mediaCapabilities=h);A=J;l=g.G7(Dpn);g.OA(t,2);S={Np:!0};return g.N(t,g.ju(Q,A,l,void 0,S),4);case 4:f=t.Z;g.mc(t,3);break;case 2:O=g.t5(t);if(O instanceof
g.Px)throw Z="GetPDE network manager error: "+O.message,Ag(Z,O),Error(Z);Ag("GetPDE fetch request error",O);throw Error("GetPDE fetch request error");case 3:m=LU(f);if(f)m!==void 0&&nU(m,"PDE");else throw Ag("Network request failed for PDE"),Error("Network request failed for PDE");return t.return(f)}})},LU=function(k){var G;
return(G=k.errorMetadata)==null?void 0:G.status},nU=function(k,G){G=G?" for "+G:"";
if(k===0)throw k="Empty response body"+G,Ag(k),Error(k);k="Response with error"+G;Ag(k);throw Error(k);},IZn=function(k){var G,v,Q,A,l,f,S,O;
return g.b(function(Z){switch(Z.j){case 1:return G=g.Kq(),v=pRg(k),Q=g.G7(Ewn),g.OA(Z,2),l={Np:!0},g.N(Z,g.ju(G,v,Q,void 0,l),4);case 4:A=Z.Z;g.mc(Z,3);break;case 2:f=g.t5(Z);if(f instanceof g.Px)throw S="offlinePlaylistSyncCheck network manager error: "+f.message,Ag(S,f),Error(S);Ag("offlinePlaylistSyncCheck fetch request error",f);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:O=LU(A);if(!A)throw Ag("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(O!==void 0)nU(O,"playlist sync");else if(!A.offlinePlaylistSyncCheckDatas||!A.offlinePlaylistSyncCheckDatas.length)throw Ag("No data for playlist sync"),Error("No data for playlist sync");return Z.return(A.offlinePlaylistSyncCheckDatas.map(function(m){return m.offlinePlaylistSyncCheckData}))}})},gv=function(k){this.j=k},kgn=function(k,G){var v,Q,A,l,f,S;
return g.b(function(O){switch(O.j){case 1:v=new Map,Q=g.n(G),A=Q.next();case 2:if(A.done){O.As(4);break}l=A.value;f=v;S=f.set;return g.N(O,k.Z(l),5);case 5:S.call(f,l,O.Z);A=Q.next();O.As(2);break;case 4:return O.return(v)}})},CU=function(k,G,v,Q,A,l){G=g.Tz(G,v);
Q=Object.assign({},l,{priority:Q,retryScheduleIntervalsInSeconds:A});return{actionType:k,entityKey:G,actionMetadata:Q}},NP=function(k,G,v,Q,A,l){this.status=k;
this.j=G;this.V=v;this.Z=Q;this.Y=A;this.downloadState=l},GgM=function(k,G,v){this.j=k;
this.B=G;this.Y=v},Aog=function(k,G){var v,Q,A,l,f,S,O,Z,m;
return g.b(function(t){switch(t.j){case 1:return v=G.entityKey,A=(Q=g.w(G.actionMetadata,u6))==null?void 0:Q.isEnqueuedForExpiredStreamUrlRefetch,g.OA(t,2),l=void 0,g.N(t,vb5(k,G),4);case 4:l=t.Z;g.OA(t,5);var J=(J=g.w(G.actionMetadata,u6))?{maximumDownloadQuality:J.maximumDownloadQuality}:void 0;return g.N(t,FqM(v,k.B,{isEnqueuedForExpiredStreamUrlRefetch:A,v8:J,offlineSourceData:l}),7);case 7:f=t.Z;g.mc(t,6,2);break;case 5:return g.t5(t,2),S=Og(G)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ag("PDE handleAdd error"),t.return(z6(G,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",S,"DOWNLOAD_STATE_FAILED"));case 6:return g.N(t,QhA(k,f,G),8);case 8:return t.return(z6(G,!0,f.orchestrationActions));case 2:return O=g.t5(t),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.J$&&O.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ag("PDE handleAdd error"),t.return(z6(G,!1,void 0,Z,m,"DOWNLOAD_STATE_FAILED"))}})},aYA=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3;
return g.b(function(iE){switch(iE.j){case 1:return v=G.entityKey,Q=g.Hb(v).entityId,g.N(iE,K4(k.j,{mode:"readonly",O7:!0},function(Zb){var Ql=yT(Zb,v,"playbackData"),Y3=yT(Zb,g.Tz(Q,"offlineVideoPolicy"),"offlineVideoPolicy");Zb=yT(Zb,g.Tz(Q,"transfer"),"transfer");return g.cK.all([Ql,Y3,Zb])}),2);
case 2:A=iE.Z;l=g.n(A);f=l.next().value;S=l.next().value;O=l.next().value;Z=f;m=S;t=O;if(!Z||!m)return iE.return(z6(G,!0));J=[];U=((V=Z)==null?0:V.playerResponseJson)?JSON.parse(Z.playerResponseJson):null;if(!(t&&U&&k.B.X("html5_refresh_deprecated_downloads"))){iE.As(3);break}r=lYs(k,U,t);return g.N(iE,fYs(k,t),4);case 4:J=iE.Z;case 3:h={lastPlayerResponseTimestampSeconds:Z.playerResponseTimestamp,offlineToken:m.offlineToken,formatIds:J};L={};if((e=t)==null?0:e.maximumDownloadQuality)L.maximumDownloadQuality=
t.maximumDownloadQuality;g.OA(iE,5);C=void 0;return g.N(iE,vb5(k,G),7);case 7:return C=iE.Z,g.OA(iE,8),g.N(iE,FqM(v,k.B,{refreshData:h,v8:L,offlineSourceData:C,mediaCapabilities:r}),10);case 10:u=iE.Z;g.mc(iE,9,5);break;case 8:return g.t5(iE,5),T=Og(G)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ag("PDE handleRefresh error"),iE.return(z6(G,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",T,"DOWNLOAD_STATE_FAILED"));
case 9:return g.N(iE,QhA(k,u,G),11);case 11:return iE.return(z6(G,!0,u.orchestrationActions));case 5:return y=g.t5(iE),Ac="PDE handleRefresh error",y instanceof Error&&(Ac="PDE handleRefresh error: "+y.message),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.J$&&y.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ag(Ac),iE.return(z6(G,
!1,void 0,E,k3,"DOWNLOAD_STATE_FAILED"))}})},vb5=function(k,G){var v,Q,A,l;
return g.b(function(f){if(f.j==1)return v=g.Hb(G.entityKey).entityId,Q=g.Tz(v,"videoDownloadContextEntity"),g.N(f,F0(k.j,Q,"videoDownloadContextEntity"),2);A=f.Z;return(l=A)!=null&&l.offlineModeType?f.return({offlineModeType:A.offlineModeType}):f.return(void 0)})},QhA=function(k,G,v){var Q,A,l,f,S;
return g.b(function(O){if(O.j==1){if(!G.frameworkUpdates||!g.w(G.frameworkUpdates,Y2))return O.return();if(!(g.w(G.frameworkUpdates,Y2).mutations&&g.w(G.frameworkUpdates,Y2).mutations.length>0&&g.w(G.frameworkUpdates,Y2).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return O.As(2);Q=g.Hb(g.w(G.frameworkUpdates,Y2).mutations[0].entityKey).entityId;return g.N(O,XU(k.j,Q),3)}if(O.j!=2){A=O.Z;l=g.w(v.actionMetadata,u6);if(S=(f=l)==null?void 0:f.playlistId)A.playlistId=S;A.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Al(k.B)?g.N(O,hg(Q,k.j,v,k.Y,A),2):g.jh(k.B)?g.N(O,MP(Q,k.j,v,k.Y),2):O.As(2)}return g.N(O,erq(g.w(G.frameworkUpdates,Y2)),0)})},z6=function(k,G,v,Q,A,l){return new NP(G?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Og(k),v,Q,A,l)},lYs=function(k,G,v){G=$pA(k.B,v.cotn,G);
v=g.VV(G);return g.ACY(G,v,k.B)},fYs=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J;
return g.b(function(r){if(r.j==1)return v=[],g.N(r,K4(k.j,{mode:"readonly",O7:!0},function(V){var U=[],h=G.offlineVideoStreams;if(h){h=g.n(h);for(var L=h.next();!L.done;L=h.next())U.push(yT(V,L.value,"offlineVideoStreams"))}return g.cK.all(U)}),2);
if(Q=r.Z)for(A=g.n(Q),l=A.next();!l.done;l=A.next())if(f=l.value,S=void 0,(S=f)==null?0:S.streamsProgress)for(O=f.streamsProgress,Z=0;Z<O.length;Z++)m=O[Z],t=JSON.parse(m.formatStreamBytes),J={itag:t.itag,lmt:t.lastModified,xtags:t.xtags},v.push(J);return r.return(v)})},i_n=function(k,G){this.j=k;
this.B=G},SlM=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r;
return g.b(function(V){switch(V.j){case 1:return v=Og(G),g.N(V,E2(k.j,"videoPlaybackPositionEntity"),2);case 2:Q=V.Z;if(Q.length===0)return V.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.OA(V,3);return g.N(V,p4.getInstance(),5);case 5:A=V.Z;if(!A)throw Error("prefStorage is undefined");return g.N(V,A.get("psi"),6);case 6:return l=V.Z,O=(S=(f=l)==null?void 0:f.u1)!=null?S:"0",g.N(V,KqA(Q,O),7);case 7:return Z=V.Z,m={isPaused:Z.watchHistoryPaused,u1:Z.syncTimestampUsec},g.N(V,A.set("psi",
m),8);case 8:if(m.isPaused){V.As(9);break}t=g.w(Z.frameworkUpdates,Y2);if(!Z.frameworkUpdates||!t){V.As(9);break}return g.N(V,erq(t),9);case 9:g.mc(V,4);break;case 3:return J=g.t5(V),r="PPE handleRefresh error: "+(J instanceof Error?J.message:"unknown error"),Ag(r),V.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return V.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},Z_g=function(k,G){var v,Q,A,l,f,S,O,Z;
return g.b(function(m){switch(m.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey).entityId,g.OA(m,2),g.N(m,p4.getInstance(),4);case 4:A=m.Z;if(!A)throw Error("prefStorage is undefined");return g.N(m,A.get("psi"),5);case 5:l=m.Z;f=g.w(G.actionMetadata,O_A);if(((S=l)==null?void 0:S.isPaused)!==!1||(O=f)==null||!O.lastPlaybackPositionSeconds){m.As(6);break}Z={key:g.Tz(Q,"videoPlaybackPositionEntity"),videoId:Q,lastPlaybackPositionSeconds:f.lastPlaybackPositionSeconds};return g.N(m,Dg(k.j,Z,"videoPlaybackPositionEntity"),
6);case 6:g.mc(m,3);break;case 2:return g.t5(m),m.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},mXn=function(k,G){var v,Q,A;
return g.b(function(l){switch(l.j){case 1:v=Og(G);g.OA(l,2);Q=g.Hb(G.entityKey).entityId;if(Q==="!*$_ALL_ENTITIES_!*$")return g.N(l,YWg(k.j),5);A=g.Tz(Q,"videoPlaybackPositionEntity");return g.N(l,hrp(k.j,A),5);case 5:g.mc(l,3);break;case 2:return g.t5(l),l.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},tsM=function(k,G){this.api=k;
this.j=G;this.logger=new g.w6("woffle");this.Z=!1;this.hB={Ot:this.Ot}},$Xq=function(k){return g.b(function(G){return G.return(zrs(k))})},Joq=function(k){var G;
return g.b(function(v){if(v.j==1)return g.N(v,g.tS3(k),2);G=v.Z;return v.return(G.filter(function(Q){return!!Q.url}).map(function(Q){return Q.url}))})},je=function(k,G){var v=g.Ws(G);
if(v===1||v===0)return Promise.resolve();(v=roA(k,G))&&v.stopVideo();k.Y=0;return $Xq(G)},b6=function(k,G,v,Q){v=v===void 0?!1:v;
Q=Q===void 0?!0:Q;G=typeof G==="string"?G:G.videoDetails.videoId;if(g.Ws(G)===2){var A=roA(k,G);A&&A.stopVideo();g.IA(G,2);k.Y=2;v?Vsg(k.j):Q&&BQA(k.j)}},roA=function(k,G){var v;
return((v=k.player)==null?void 0:v.getVideoData().videoId)===G?k.player:null},w4A=function(k,G){this.j=k;
this.B=G},UX7=function(k,G){var v,Q;
return g.b(function(A){switch(A.j){case 1:return v=Og(G),g.N(A,F0(k.j,G.entityKey,"transfer"),2);case 2:if(Q=A.Z)return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.OA(A,3);return g.N(A,dXM(k,G),5);case 5:g.mc(A,4);break;case 3:return g.t5(A),A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},co7=function(k,G){var v,Q;
return g.b(function(A){switch(A.j){case 1:return v=Og(G),g.N(A,F0(k.j,G.entityKey,"transfer"),2);case 2:Q=A.Z;if(!Q||Q.transferState!=="TRANSFER_STATE_COMPLETE")return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.OA(A,3);return g.N(A,dXM(k,G,!0),5);case 5:g.mc(A,4);break;case 3:return g.t5(A),A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},hOg=function(k,G){var v,Q,A,l,f,S,O,Z,m,t;
return g.b(function(J){switch(J.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey).entityId,g.N(J,K4(k.j,{mode:"readonly",O7:!0},function(r){var V=yT(r,G.entityKey,"transfer");r=yT(r,g.Tz(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.cK.all([V,r])}),2);
case 2:A=J.Z;l=g.n(A);f=l.next().value;S=l.next().value;O=f;Z=S;if(!O||O.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return J.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.OA(J,3);O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.N(J,Dg(k.j,O,"transfer"),5);case 5:m=g.Hb(O.key).entityId;i0n({videoId:m,qf:O,offlineModeType:(t=Z)==null?void 0:t.offlineModeType});g.mc(J,4);break;case 3:return g.t5(J),J.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},dXM=function(k,G,v){v=v===void 0?!1:v;
var Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L;return g.b(function(e){switch(e.j){case 1:return Q=g.w(G.actionMetadata,YlA),A=g.Hb(G.entityKey).entityId,l=g.Tz(A,"downloadStatusEntity"),g.N(e,K4(k.j,{mode:"readonly",O7:!0},function(C){var u=yT(C,l,"downloadStatusEntity");C=yT(C,g.Tz(A,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.cK.all([u,C])}),2);
case 2:return f=e.Z,S=g.n(f),O=S.next().value,Z=S.next().value,m=O,t=Z,J="TRANSFER_STATE_TRANSFER_IN_QUEUE",((r=m)==null?void 0:r.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(J="TRANSFER_STATE_PAUSED_BY_USER"),h={key:G.entityKey,transferState:J,cotn:g.VO(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(V=Q)==null?void 0:V.maximumDownloadQuality,preferredAudioTrack:(U=Q)==null?void 0:U.preferredAudioTrack,transferRetryCount:0,isRefresh:v,hasLoggedFirstStarted:!1},g.N(e,K4(k.j,
{mode:"readwrite",O7:!0},function(C){var u=[];v&&u.push(Pg(C,g.Tz(A,"offlineVideoStreams")));u.push(Rq(C,h,"transfer"));return g.cK.all(u)}),3);
case 3:if(!v){e.As(4);break}return g.N(e,$Xq(A),4);case 4:fZn({videoId:A,qf:h,offlineModeType:(L=t)==null?void 0:L.offlineModeType}),g.SH(e)}})},Msg=function(k,G,v,Q){if(!k.action.entityKey)throw Error("entityKey is missing.");
var A=g.Hb(k.action.entityKey);A={entityType:A.Km,entityId:A.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};G&&(A.offlineOrchestrationActionResult=G.status,A.isRetryable=v?!1:G.j,G.Y&&(A.offlineOrchestrationFailureReason=X47(G.Y,A.isRetryable)));var l,f;if((l=k.action.actionMetadata)==null?0:(f=l.offlineLoggingData)==null?0:f.offlineModeType)A.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;Q&&(A.additionalOrchestrationActions=
Q.map(function(S){return{orchestrationActionId:S.actionId}}));
return A},X47=function(k,G){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||G?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&G?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},sh7=function(k,G){var v={offlineOrchestrationContext:Msg(k)};
G=HGg(G,v);TTA(ySs(),G,k.rootActionId)},xXg=function(k,G,v,Q){Q=Q===void 0?[]:Q;
G={offlineOrchestrationContext:Msg(k,G,v,Q)};G=HGg(3,G);TTA(ySs(),G,k.rootActionId)},eOA=function(){this.actions=[]},LTn=function(k,G){G=g.n(G);
for(var v=G.next();!v.done;v=G.next())v=v.value,sh7(v,1),k.actions.push(v);k.actions.sort(k.j)},nbA=function(k,G){if(G)for(var v=0;v<k.actions.length;v++)if(G==="!*$_ALL_ENTITIES_!*$"&&k.actions[v].actionId!==G||G!=="!*$_ALL_ENTITIES_!*$"&&k.actions[v].rootActionId===G&&k.actions[v].actionId!==G)k.actions.splice(v,1),v--},gbH=function(k,G){k=g.n(k.actions);
for(var v=k.next();!v.done;v=k.next())if(v.value.actionId===G)return!0;return!1},pU=function(k,G,v,Q,A){g.W.call(this);
var l=this;this.Z=k;this.Vh=G;this.Z$=v;this.W=Q;this.B=A;this.j=new eOA;this.G=new g.Rk;this.Y=new g.F3(function(){l.retry()});
this.D=NaN;this.S=!1;this.hB={b5p:function(){return l.j},
Ia:function(){return l.G},
DMl:function(){return l.Y},
retry:function(){return l.retry()}};
g.I(this,this.Y);this.hs=this.Z.observe(this.zN.bind(this))},ujA=function(k,G,v,Q,A){var l;
return g.b(function(f){if(f.j==1)return l=new pU(k,G,v,Q,A),g.N(f,C5A(l),2);NQ5(l);return f.return(l)})},NQ5=function(k){var G=k.j.actions[0];
return k.V?((G==null?void 0:G.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.V[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.S=!0),Promise.resolve()):zOA(k)},zOA=function(k){var G,v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L;
return g.b(function(e){switch(e.j){case 1:if(k.V)throw Error("Already processing an action");if(k.Js())return e.return();G=k.j.actions.shift();AkM(k.Z$,!G);if(G===void 0)return e.return();G.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&G.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&nbA(k.j,G.actionId);v="";G.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&G.rootActionId===G.actionId&&(v=G.actionId);Q=[G];k.V=Q;if(A=k.Vh[G.entityType]){e.As(2);break}k.V=
void 0;return g.N(e,zOA(k),3);case 3:return e.return();case 2:l=g.n(Q);for(f=l.next();!f.done;f=l.next())S=f.value,sh7(S,2);g.OA(e,4,5);return g.N(e,kgn(A,Q.map(function(C){return C.action})),7);
case 7:O=e.Z,Z=g.n(Q),m=Z.next();case 8:if(m.done){e.As(10);break}t=m.value;J=O.get(t.action);return g.N(e,jhM(k,t,J),9);case 9:m=Z.next();e.As(8);break;case 10:nbA(k.j,v);case 5:g.$p(e);k.V=void 0;g.J5(e,6);break;case 4:return r=g.t5(e),Ag("Orchestration error",r),g.OA(e,12),g.N(e,b_g(k,Q),14);case 14:g.mc(e,5);break;case 12:V=g.t5(e);Ag("Orchestration retry error",V);U=g.n(Q);for(h=U.next();!h.done;h=U.next())L=h.value,L.retryScheduleIndex<3&&LTn(k.j,[L]);e.As(5);break;case 6:return g.N(e,zOA(k),
0)}})},jhM=function(k,G,v){var Q,A,l,f,S,O,Z,m,t,J,r,V;
return g.b(function(U){switch(U.j){case 1:Q=G.retryScheduleIndex+2===3;if(v.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){U.As(2);break}if(v.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){U.As(0);break}xXg(G,v,Q);if(v.j&&G.retryScheduleIndex+1<3)return g.N(U,b_g(k,[G]),0);l=((A=v)==null?0:A.Z)?v.Z:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";f={entityKey:G.action.entityKey,failureReason:l};S=void 0;g.Al(k.B)?S="mainVideoDownloadStateEntity":g.jh(k.B)&&(S="musicTrackDownloadMetadataEntity");
if(!S||!v.downloadState){U.As(7);break}O=g.Hb(G.action.entityKey).entityId;return g.N(U,$2(O,S,k.Z,v.downloadState),7);case 7:fU(k.W,f);if(v.downloadState==="DOWNLOAD_STATE_FAILED"&&k.B.X("html5_auto_retry_failed_pde_actions")){U.As(0);break}Ag("Orchestration result is not retryable, deleting action");return g.N(U,hrp(k.Z,dv(G).key),0);case 2:Z=void 0;try{Z=(m=v.V)==null?void 0:m.map(function(h){return k.createAction(h,G)})}catch(h){return xXg(G,v,Q),t={entityKey:G.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},fU(k.W,t),Ag("Orchestration subactions creation error",h),U.return()}xXg(G,v,Q,Z);if(!Z){U.As(12);break}J=Z.map(function(h){return dv(h)});
r=0;case 13:if(!(r<Z.length)||k.S){U.As(15);break}return g.N(U,K4(k.Z,{mode:"readwrite",O7:!0},function(h){var L=[];L.push(t0c(h,J.slice(r,r+10),"offlineOrchestrationActionWrapperEntity"));return g.cK.all(L)}),16);
case 16:r+=10;U.As(13);break;case 15:if(k.S)return k.S=!1,U.return();case 12:return V=dv(G),g.N(U,hrp(k.Z,V.key),17);case 17:sh7(G,4),g.SH(U)}})},yog=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r;
return g.b(function(V){v=[];Q=Infinity;A=4E3;l=g.n(G);for(f=l.next();!f.done;f=l.next())S=f.value,O=Number(S.enqueueTimeSec),Z=p45(O),m=S.retryScheduleIndex,t=m!=null&&m>0,Z>0&&t?(Q=Math.min(Q,O),A=Math.min(Z,A)):v.push(S);isFinite(Q)&&(!k.Y.isActive()||Q<k.D)&&(k.D=Q,k.Y.start(A));k.G.oF()||(J=v.length,v=v.filter(function(U){var h;U=((h=U.actionProto)==null?void 0:h.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!WTs.includes(U)}),r=v.length<J,!k.Y.isActive()&&r&&k.Y.start(1));
v.length>0&&IY5(k,v);return g.N(V,NQ5(k),0)})},TQM=function(k){var G,v,Q,A,l,f,S;
return g.b(function(O){if(O.j==1)return g.N(O,H_H(k),2);G=O.Z;v=[];Q=g.n(G);for(A=Q.next();!A.done;A=Q.next())l=A.value,f=g.Hb(l.key),S=f.entityId,gbH(k.j,S)||v.push(l);return g.N(O,yog(k,v),0)})},p45=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},b_g=function(k,G){var v,Q,A;
return g.b(function(l){v=g.n(G);for(Q=v.next();!Q.done;Q=v.next()){A=Q.value;var f=void 0,S=void 0,O=((S=A.action)==null?void 0:(f=S.actionMetadata)==null?void 0:f.retryScheduleIntervalsInSeconds)||[1,2,4];f=1;A.retryScheduleIndex<O.length&&(f=O[A.retryScheduleIndex]);A.j=f*1E3+Date.now();A.retryScheduleIndex++}return g.N(l,ROq(k,G),0)})},C5A=function(k){var G;
return g.b(function(v){if(v.j==1)return g.N(v,E2(k.Z,"offlineOrchestrationActionWrapperEntity"),2);G=v.Z;return g.N(v,yog(k,G),0)})},IY5=function(k,G){G.length!==0&&G.forEach(function(v){v=wv(v);
v.retryScheduleIndex<3&&LTn(k.j,[v])})},H_H=function(k,G){var v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,E2(k.Z,"offlineOrchestrationActionWrapperEntity",G),2);v=Q.Z;return Q.return(v.filter(LKH))})},ROq=function(k,G){if(G.length===0)return Promise.resolve([]);
G=G.map(function(v){return dv(v)});
return cSp(k.Z,G)},P5A=function(k){this.sA=k;
this.j=void 0},qls=function(k,G){var v,Q,A,l;
return g.b(function(f){v=G.videoId;Q=!0;if(G.captionTracks.length)A=Q$p(G),k.j=new g.Bo(k.sA,G,A);else if(G.U7)l=g.sb8(G),k.j=new g.UJ(k.sA,G.U7,v,l,G.zg,G.eventId),Q=G.zg;else return f.return();return f.return(new Promise(function(S){var O;(O=k.j)==null||O.QL({Gg:function(){return g.b(function(Z){if(Z.j==1)return g.N(Z,k.Gg(v,Q),2);S();g.SH(Z)})},
Kj:function(){}})}))})},obA=function(k){var G;
return g.b(function(v){if(v.j==1)return g.N(v,uLp(k),2);G=v.Z;return v.return(!!G&&G.length>0)})},Wm=function(k){g.W.call(this);
this.j=k;this.Z=this.j.observe(this.Y.bind(this))},KTw=function(k,G){var v,Q,A,l,f,S,O;
return g.b(function(Z){switch(Z.j){case 1:if(G.length===0)return Z.return([]);v=G.map(function(m){return g.Tz(m,"transfer")});
return g.N(Z,E2(k.j,"transfer",v),2);case 2:Q=Z.Z;A=Q.filter(LKH).map(function(m){return g.Hb(m.key).entityId});
l=G.filter(function(m){return A.indexOf(m)===-1});
if(l.length===0)return Z.return([]);f=g.n(l);S=f.next();case 3:if(S.done){Z.As(5);break}O=S.value;return g.N(Z,$Xq(O),4);case 4:S=f.next();Z.As(3);break;case 5:return Z.return(l)}})},Ebp=function(k,G,v,Q,A,l){var f,S,O;
return g.b(function(Z){f="STREAM_TYPE_UNKNOWN";v.video&&v.audio?(f="STREAM_TYPE_AUDIO_AND_VIDEO",Ag("unexpected stream type")):v.video&&!v.audio?f="STREAM_TYPE_VIDEO":!v.video&&v.audio&&(f="STREAM_TYPE_AUDIO");S=g.Tz(G,"offlineVideoStreams");O={numBytesDownloaded:A.toFixed(),numTotalBytes:l.toFixed(),streamType:f,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(Q),itag:f==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(v.itag):void 0};return g.N(Z,K4(k,{mode:"readwrite",O7:!0},
function(m){var t=yT(m,S,"offlineVideoStreams"),J=yT(m,g.Tz(G,"transfer"),"transfer");return g.cK.all([t,J]).then(function(r){r=g.n(r);var V=r.next().value;r=r.next().value;if(!r)return Pg(m,S).then(function(){});
var U=DXp(V);V=FTg(V,Q,O,S);var h=Rq(m,V,"offlineVideoStreams");DXp(V)>U&&(r.lastProgressTimeMs=Date.now().toString());U=[h];r.offlineVideoStreams||(r.offlineVideoStreams=[]);r.offlineVideoStreams.indexOf(S)===-1&&(r.offlineVideoStreams.push(S),U.push(Rq(m,r,"transfer")));return g.cK.all(U)})}),0)})},kDw=function(k,G){var v,Q,A,l,f;
return g.b(function(S){if(S.j==1)return v=g.Tz(G,"offlineVideoStreams"),g.N(S,F0(k,v,"offlineVideoStreams"),2);Q=S.Z;if(!Q||!Q.streamsProgress)return S.return();A=g.n(Q.streamsProgress);for(l=A.next();!l.done;l=A.next())f=l.value,f.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",f.numTotalBytes!==f.numBytesDownloaded&&(f.numBytesDownloaded=f.numTotalBytes);return g.N(S,Dg(k,Q,"offlineVideoStreams"),0)})},FTg=function(k,G,v,Q){if(k&&k.streamsProgress){Q=k;
a:{G=G.itag+";"+G.xtags;for(var A=k.streamsProgress,l=0;l<A.length;l++){var f=JSON.parse(A[l].formatStreamBytes);if(f.itag+";"+f.xtags===G){A[l]=v;v=A;break a}}A.push(v);v=A}Q.streamsProgress=v}else k={key:Q,streamsProgress:[v]};return k},DXp=function(k){if(k==null?0:k.streamsProgress){var G=0;
k=k.streamsProgress;for(var v=0;v<k.length;v++){var Q=k[v];isNaN(Number(Q.numBytesDownloaded))?Ag("stream progress bytes number invalid"):G+=Number(Q.numBytesDownloaded)}return G}return 0},GDn=function(k,G,v,Q){g.W.call(this);
var A=this;this.Z=k;this.api=G;this.Cp=v;this.zN=Q;this.G=new g.Rk;this.V=new g.F3(function(){A.j&&A.j.transferState==="TRANSFER_STATE_TRANSFERRING"&&A.G.oF()&&((A.j.transferRetryCount||0)<3?b6(A.W,A.S,!1,!1):je(A.W,A.S.videoDetails.videoId),A.UM("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Z$=this.Hd=0;this.hs=this.D=!1;this.Pd=g.DH(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.Wd=new g.Z1(this);this.hB={Txp:function(){return A.V},
oRp:function(){return A.zN},
Ia:function(){return A.G}};
this.Vh=this.Z.observe(this.LQ.bind(this));this.W=new tsM(G,this);this.Kp=new P5A(G);this.XI=new Wm(this.Z);this.GN=this.G.listen("publicytnetworkstatus-online",this.gW.bind(this));this.qV=this.G.listen("publicytnetworkstatus-offline",this.AWI.bind(this));this.hs=this.api.K().X("html5_less_transfer_processing_logs");g.I(this,this.Wd);this.Wd.U(G,"offlinetransferpause",this.lhl);if(g.Al(this.api.K()))this.Y="mainVideoDownloadStateEntity";else if(g.jh(this.api.K())||g.fu(this.api.K()))this.Y="musicTrackDownloadMetadataEntity"},
v7H=function(k){return g.b(function(G){if(G.j==1)G=g.N(G,CaH(),2);
else{var v=k.XI;var Q=g.pu();Q=Object.keys(Q);v=KTw(v,Q);G=g.N(G,v,0)}return G})},ym=function(k,G){G=G===void 0?!1:G;
var v;return g.b(function(Q){if(Q.j==1){if(k.j)throw Error("Already downloading a video");k.Z$=0;k.D=!1;return g.N(Q,Q8A(k),2)}return Q.j!=4?(v=Q.Z,lZ5(k.Cp,!v),v&&k.G.oF()?G?g.N(Q,new Promise(function(A){g.UT(A,1E3)}),4):Q.As(4):(!v&&k.j&&Ip(k),Q.As(0))):g.N(Q,AF7(k,v),0)})},luq=function(k){return g.b(function(G){if(G.j==1)return k.S?g.N(G,je(k.W,k.S.videoDetails.videoId),3):G.As(0);
Ip(k);g.SH(G)})},fup=function(k,G){var v,Q,A;
return g.b(function(l){switch(l.j){case 1:return g.OA(l,2),(v=!!G.captionTracks.length||!!G.U7)?g.N(l,obA(G.videoId),4):l.return();case 4:return(Q=l.Z)?l.return():g.N(l,qls(k.Kp,G),5);case 5:g.mc(l,0);break;case 2:A=g.t5(l),Ag("Caption downloading error",A,G.cotn),g.SH(l)}})},AF7=function(k,G){var v,Q,A,l,f,S;
return g.b(function(O){switch(O.j){case 1:if(k.D)return O.return();k.D=!0;k.j=G;v=g.Hb(k.j.key);Q=v.entityId;A=void 0;if(k.j.transferState==="TRANSFER_STATE_TRANSFERRING")return g.N(O,Hm(k,Q),7);if(k.j.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.j.transferRetryCount||k.j.hasLoggedFirstStarted){O.As(3);break}return g.N(O,Hm(k,Q),5);case 5:return A=O.Z,k.j.hasLoggedFirstStarted=!0,g.N(O,auH(k),6);case 6:aZA({videoId:Q,qf:k.j,offlineModeType:A},void 0,void 0,!0);O.As(3);break;case 7:A=O.Z,
Se({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:Q,qf:k.j,offlineModeType:A});case 3:return g.N(O,iFH(k),8);case 8:return l=null,g.OA(O,9),g.N(O,SaM(k,G),11);case 11:l=O.Z;k.S=l;g.mc(O,10);break;case 9:return f=g.t5(O),Ag("error getting player response",f,G.cotn),g.N(O,k.UM("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return O.return();case 10:return S=$pA(k.api.K(),G.cotn,l),g.N(O,fup(k,S),13);case 13:return g.N(O,Joq(S.videoId),
14);case 14:S.PY=O.Z;var Z=k.W,m=S,t=G.maximumDownloadQuality;m.getPlayerResponse();g.IA(m.videoId,2);Z.Y=2;Z.Z=!1;var J;(J=Z.player)==null||J.dispose();Z.player=Z.api.vv(m);m={};Z.player.oi((m.localmediachange=Z.qQ,m.signatureexpired=Z.vT,m.statechange=Z.WrI,m),Z);Z.X("html5_generate_content_po_token")&&Z.player.x6();t=Z.Ot(t);Z.player.jl(g.Cv(t,t,!0,"m"),!1);Z.player.qq(!1);k.V.start(108E5);g.SH(O)}})},Q8A=function(k){var G,v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,E2(k.Z,"transfer"),2);G=Q.Z;v=G.filter(OFg).sort(ZFg);return v.length===0?Q.return():Q.return(v[0])})},iFH=function(k){var G,v,Q;
return g.b(function(A){if(A.j==1){if(!k.j)return T6(k,"onTransferStart"),A.return();k.V.start(108E5);return g.N(A,Rp(k,"TRANSFER_STATE_TRANSFERRING"),2)}G=k.j;return(Q=((v=G)==null?0:v.key)?g.Hb(G.key).entityId:"")&&k.Y?g.N(A,$2(Q,k.Y,k.Z,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):A.As(0)})},Vsg=function(k){var G,v,Q,A;
g.b(function(l){switch(l.j){case 1:if(!k.j){T6(k,"onTransferPausedByUser");l.As(2);break}G=k.j;k.V.stop();return g.N(l,Rp(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:Q=((v=G)==null?0:v.key)?g.Hb(G.key).entityId:"";if(!Q||!k.Y){l.As(4);break}return g.N(l,$2(Q,k.Y,k.Z,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.N(l,Hm(k,Q),6);case 6:A=l.Z,Sws({videoId:Q,qf:G,offlineModeType:A});case 2:Ip(k),ym(k),g.SH(l)}})},BQA=function(k){var G,v,Q;
g.b(function(A){if(A.j==1){if(!k.j)return T6(k,"onTransferPausedByNetwork"),A.return();k.V.stop();return g.N(A,Rp(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(A.j!=3)return G=k.j,(Q=((v=G)==null?0:v.key)?g.Hb(G.key).entityId:"")&&k.Y?g.N(A,$2(Q,k.Y,k.Z,"DOWNLOAD_STATE_PAUSED"),3):A.As(3);Ip(k);g.SH(A)})},mmH=function(k){var G,v,Q,A,l;
g.b(function(f){switch(f.j){case 1:if(!k.j)return T6(k,"onTransferComplete"),f.return();G=k.j;k.V.stop();if(!G||!k.S){f.As(2);break}v=$pA(k.api.K(),G.cotn,k.S);return g.N(f,fup(k,v),2);case 2:return g.N(f,Rp(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:A=((Q=G)==null?0:Q.key)?g.Hb(G.key).entityId:"";if(!A||!k.Y){f.As(5);break}return g.N(f,$2(A,k.Y,k.Z,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.N(f,kDw(k.Z,A),7);case 7:return g.N(f,Hm(k,A),8);case 8:l=f.Z,Se({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:A,qf:G,offlineModeType:l}),Ip(k),ym(k),g.SH(f)}})},tjH=function(k,G,v){var Q,A;
g.b(function(l){switch(l.j){case 1:if(!k.j)return T6(k,"onTransferProgress: "+G),l.return();if(k.j.transferState==="TRANSFER_STATE_TRANSFERRING"){l.As(2);break}return g.N(l,iFH(k),2);case 2:Q=Date.now();if(!(Q-k.Hd>1E3)){l.As(4);break}k.Hd=Q;return g.N(l,Ebp(k.Z,v.videoId,v.Z,v.rj,v.bytesDownloaded,v.j),5);case 5:if(k.hs&&!(k.hs&&Q-k.Z$>k.Pd)){l.As(4);break}k.Z$=Q;return g.N(l,Hm(k,G),7);case 7:A=l.Z,aZA({videoId:G,qf:k.j,offlineModeType:A},v.bytesDownloaded,v.j);case 4:k.V.start(108E5),g.SH(l)}})},
$mq=function(k){var G=(k.j.transferRetryCount||0)<3;
G&&(k=k.j,k.transferRetryCount=(k.transferRetryCount||0)+1);return G},JF7=function(k,G){G=G===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":G;
var v,Q,A,l;return g.b(function(f){if(f.j==1)return k.j||T6(k,"setTransferToFailed: "+G),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G==="TRANSFER_FAILURE_REASON_NETWORK"?v="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":G==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.N(f,Rp(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",G),2);if(f.j!=3)return fU(k.zN,{entityKey:(Q=k.j)==null?void 0:Q.key,failureReason:v}),
A=k.j?g.Hb(k.j.key).entityId:"",g.N(f,Hm(k,A),3);l=f.Z;var S={videoId:A,qf:k.j,offlineModeType:l},O=G,Z={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};O&&(Z.transferFailureReason=O,Z.failureReason=O05(O));Se(Z,S);g.SH(f)})},Rp=function(k,G,v,Q){var A;
return g.b(function(l){if(l.j==1){if(!k.j)return T6(k,"saveTransferState: "+G),l.return();k.j.transferState=G;k.j.failureReason=Q;g.OA(l,2);return g.N(l,auH(k,function(f){return v?Hg(f,"offlineVideoStreams",k.j.offlineVideoStreams).then(function(S){for(var O=g.n(S),Z=O.next();!Z.done;Z=O.next())if((Z=Z.value)&&Z.streamsProgress){Z=g.n(Z.streamsProgress);for(var m=Z.next();!m.done;m=Z.next())m.value.streamState=v}return t0c(f,S.filter(function(t){return!!t}),"offlineVideoStreams")}):g.cK.resolve(void 0)}),
4)}if(l.j!=2)return g.mc(l,0);
A=g.t5(l);return A instanceof g.J$&&A.type==="QUOTA_EXCEEDED"?g.N(l,k.UM("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):l.As(0)})},auH=function(k,G){var v;
return g.b(function(Q){if(!k.j)return Q.return();v=k.j;return g.N(Q,K4(k.Z,{mode:"readwrite",O7:!0},function(A){var l=[Rq(A,v,"transfer")];G&&l.push(G(A));return g.cK.all(l)}),0)})},Ip=function(k){k.j=void 0;
k.S=void 0;k.V.stop()},SaM=function(k,G){var v,Q,A,l,f;
return g.b(function(S){if(S.j==1)return v=g.Hb(G.key),Q=v.entityId,A=g.Tz(Q,"playbackData"),g.N(S,F0(k.Z,A,"playbackData"),2);l=S.Z;if((f=l)==null?0:f.playerResponseJson)return S.return(JSON.parse(l.playerResponseJson));throw Error("No PlayerResponse found");})},T6=function(k,G){k.api.wl("woffle",{mcte:G});
Ag("missing current transfer entity.")},Hm=function(k,G){var v,Q,A;
return g.b(function(l){if(l.j==1)return g.N(l,F0(k.Z,g.Tz(G,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);v=l.Z;return l.return((A=(Q=v)==null?void 0:Q.offlineModeType)!=null?A:void 0)})},OFg=function(k){return rFg[k.transferState]!==void 0},ZFg=function(k,G){var v=rFg[k.transferState],Q=rFg[G.transferState];
return v!==Q?v-Q:Number(k.enqueuedTimestampMs)-Number(G.enqueuedTimestampMs)},Pm=function(k,G){var v=this;
this.B=k;this.api=G;this.G=new g.Rk;this.S=new g.mX;this.hB={Gr:function(){return v.Y.hB.Gr()},
Ia:function(){return v.G},
vRA:function(){return v.Y},
aL:function(){return v.aL()},
bz:function(){return v.bz()},
e_:function(){return v.e_()},
M8:function(){return v.M8()},
KD:function(){return v.KD()},
aE:function(Q){return v.aE(Q)}};
this.Y=new Gd7(function(){return Vjg(v)},function(){v.e_()},this.api.HA(),this.api.X.bind(this.api));
this.j=new l6(this.api);vwM(this.Y)},Vjg=function(k){return g.b(function(G){k.api.yh("onOrchestrationBecameLeader");
return g.N(G,k.bz(),0)})},weH=function(k){var G,v;
return g.b(function(Q){if(Q.j==1)return g.N(Q,k2(),2);if(Q.j!=3){G=Q.Z;if(!G)return Ag("PES is undefined"),Q.return();k.Z=new GDn(G,k.api,k.Y,k.j);v=k.Zm(G);return g.N(Q,ujA(G,v,k.Y,k.j,k.B),3)}k.W=Q.Z;return g.N(Q,Bz5(k),0)})},Bz5=function(k){var G;
return g.b(function(v){switch(v.j){case 1:if(!k.Z)return Ag("transferManager is undefined"),v.return();if(k.Z.j){v.As(2);break}return g.N(v,ym(k.Z),2);case 2:if(!k.B.X("woffle_enable_main_downloads_library")){v.As(4);break}return g.N(v,k.sV(),4);case 4:if(!k.B.X("html5_offline_playback_position_sync")){v.As(6);break}return g.N(v,k.m4(),7);case 7:return g.N(v,k.aE(864E5),6);case 6:return g.N(v,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.N(v,k.vN(),10);case 10:if(!k.B.X("html5_retry_downloads_for_expiration")){v.As(11);
break}return g.N(v,k.KD(),11);case 11:return k.D=g.cH(function(){k.refreshAllStaleEntities(43200,!0);k.vN()},9E5),g.kJ(g.vK(),function(){return k.M8()}),g.N(v,k2(),13);
case 13:return G=v.Z,g.N(v,kdH(G),14);case 14:Q6c(k.Y),g.SH(v)}})},dms=function(){var k,G,v,Q,A,l;
return g.b(function(f){switch(f.j){case 1:return g.N(f,k2(),2);case 2:k=f.Z;if(!k)return f.return([]);G=Date.now()/1E3;return g.N(f,E2(k,"offlineVideoPolicy"),3);case 3:v=f.Z,Q=g.n(v),A=Q.next();case 4:if(A.done){f.As(6);break}l=A.value;if(!(l.expirationTimestamp&&Number(l.expirationTimestamp)<G)){f.As(5);break}l.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";l.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.N(f,Dg(k,l,"offlineVideoPolicy"),5);
case 5:A=Q.next();f.As(4);break;case 6:return f.return(v.map(function(S){return S.key}))}})},qP=function(k,G,v,Q,A){var l,f,S;
return g.b(function(O){if(O.j==1)return g.N(O,k2(),2);l=O.Z;if(!l)return O.return([]);f=G.map(function(Z){var m=g.Tz(Z,v);m={actionType:Q,entityKey:m,actionMetadata:Object.assign({},Jkg(),A)};Q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(m.actionMetadata.priority=0);Z=new Bm(v,Z,m);return dv(Z)});
S=cSp(l,f);vwM(k.Y);return O.return(S)})},UmA=function(k,G,v,Q){var A,l,f,S,O,Z,m,t;
return g.b(function(J){switch(J.j){case 1:A=[],l=g.n(G),f=l.next();case 2:if(f.done){J.As(4);break}S=f.value;if(S.upToDate||v&&!S.shouldAutoSyncMetadata||!S.playlistId){J.As(3);break}O={};switch(Q){case "mainPlaylistEntity":Z={nextAutoRefreshIntervalSeconds:S.checkInSeconds,autoSync:v};O={mainPlaylistEntityActionMetadata:Z};break;case "musicPlaylist":m={autoSync:v},O={musicPlaylistEntityActionMetadata:m}}return g.N(J,qP(k,[S.playlistId],Q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O),6);case 6:(t=
J.Z)&&A.push.apply(A,g.Db(t));case 3:f=l.next();J.As(2);break;case 4:return J.return(A)}})},cF7=function(k,G){var v;
return g.b(function(Q){return G.length?(v=Jkg(),g.jA(v,u6,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.wl("qrd",{v:G.length}),Q.return(qP(k,G,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v))):Q.return([])})},hdq=function(k,G,v){this.j=k;
this.B=G;this.Y=v},Mj7=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e;
return g.b(function(C){switch(C.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,l=[],g.OA(C,2),g.N(C,YaH(k,A),4);case 4:l=C.Z;if(!(k.B.X("woffle_enable_main_downloads_library")&&((f=l)==null?0:f.length))){C.As(5);break}return g.N(C,xpA(k.j,[G.entityKey]),5);case 5:g.mc(C,3);break;case 2:return S=g.t5(C),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.J$&&S.type==="QUOTA_EXCEEDED"?(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Ag("Playlist add error"),C.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,O,Z));case 3:m=[];if(!k.B.X("html5_offline_prevent_redownload_downloaded_video")){C.As(7);break}return g.N(C,tZM(k.j,"mainVideoEntity",l),8);case 8:l=C.Z;case 7:if((t=l)==null?0:t.length)for(J=g.n(l),r=J.next();!r.done;r=J.next())if(V=r.value,U=V.offlineVideoData,h=void 0,(h=U)==null?0:h.videoId)L=void 0,e=Number(((L=G.actionMetadata)==null?void 0:L.priority)||
0)+1,m.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U.videoId,"mainVideoEntity",e,op,Xen(G,U,A)));return C.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,m))}})},xmp=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY,Lg,Y,Gu,Us,ij,D8,Os,Ks,kp,MK,M,c,X,z,q,a7,D,R,p,ns,g8,w8,eY,Qn,sz,yY,NK,Dq,Ls,Wl,Cs,h5,ps,Ut,Xs;
return g.b(function(Fs){switch(Fs.j){case 1:return v=Og(G),Q=G.entityKey,A=g.Hb(Q).entityId,l=[],f=!1,A==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.N(Fs,E2(k.j,"mainPlaylistEntity"),5)):g.N(Fs,F0(k.j,Q,"mainPlaylistEntity"),4);case 4:(S=Fs.Z)&&l.push(S);Fs.As(3);break;case 5:l=Fs.Z;case 3:if((O=l)==null||!O.length)return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));Z=g.w(G.actionMetadata,s8A);t=(m=Z)==null?void 0:m.nextAutoRefreshIntervalSeconds;r=(J=Z)==null?void 0:J.autoSync;V=[];h=U=
!0;L=!1;if(!f&&r===!1){Fs.As(6);break}g.OA(Fs,7);return g.N(Fs,ykA(0,!!r,!0,l),9);case 9:V=Fs.Z;g.mc(Fs,8);break;case 7:e=g.t5(Fs);if(!(e instanceof Error&&e.message==="No data")){e instanceof Error&&e.message==="Empty response body"&&Ag(e.message);Fs.As(8);break}return A==="!*$_ALL_ENTITIES_!*$"?g.N(Fs,ckn(k.j,G,k.Y,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.N(Fs,dpn(A,k.j,G,k.Y),8);case 8:if(!V.length||!f&&V[0].playlistId!==A)return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));case 6:if(f){C=[];u=g.n(V);for(T=u.next();!T.done;T=u.next())y=T.value,y.upToDate||r&&!y.shouldAutoSyncMetadata||!y.playlistId||(Ac={nextAutoRefreshIntervalSeconds:y.checkInSeconds,autoSync:r},C.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",y.playlistId,"mainPlaylistEntity",0,op,{mainPlaylistEntityActionMetadata:Ac})));return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,C))}V.length&&(E=V[0],L=!!E.upToDate,r&&(U=(k3=E.shouldAutoSyncMetadata)!=null?k3:!0,h=(iE=E.shouldAutoSyncVideos)!=
null?iE:!0,E.checkInSeconds&&(t=E.checkInSeconds)));if(L||!U)return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));Zb=[];Ql=l[0];if(!Ql.downloadState){Y3=void 0;Fs.As(15);break}return g.N(Fs,F0(k.j,Ql.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Y3=Fs.Z;case 15:return Gn=Y3,fg=((iA=Gn)==null?0:iA.addedTimestampMillis)?String(Gn.addedTimestampMillis):void 0,g.OA(Fs,17),g.N(Fs,YaH(k,A,fg,t),19);case 19:Zb=Fs.Z;g.mc(Fs,18);break;case 17:R7=g.t5(Fs);if(!(R7 instanceof
Error&&R7.message==="No data for playlist")){if(R7 instanceof Error&&R7.message==="Empty response body for playlist")Ag(R7.message);else return o7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R7 instanceof g.J$&&R7.type==="QUOTA_EXCEEDED"&&(o7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,o7,Kg));
Fs.As(18);break}return g.N(Fs,dpn(A,k.j,G,k.Y),18);case 18:if(!h)return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));ng=[];x=new Map;if((wA=Zb)==null?0:wA.length)for(qw=g.n(Zb),SY=qw.next();!SY.done;SY=qw.next())Lg=SY.value,Y=Lg.offlineVideoData,Gu=void 0,((Gu=Y)==null?0:Gu.videoId)&&x.set(Y.videoId,Y);Us=new Map;ij=[];if((D8=Ql)==null?0:(Os=D8.videos)==null?0:Os.length)for(Ks=g.n(Ql.videos),kp=Ks.next();!kp.done;kp=Ks.next())if(MK=kp.value,M=JSON.parse(g.Hb(MK).entityId),c=
M.videoId)x.has(c)?(Us.set(c,x.get(c)),x.delete(c)):ij.push(c);z=Number(((X=G.actionMetadata)==null?void 0:X.priority)||0)+1;q=g.n(x.entries());for(a7=q.next();!a7.done;a7=q.next())D=a7.value,R=g.n(D),p=R.next().value,ns=R.next().value,g8=p,w8=ns,ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",g8,"mainVideoEntity",z,op,Xen(G,w8,A)));eY=g.n(Us.entries());for(Qn=eY.next();!Qn.done;Qn=eY.next())sz=Qn.value,yY=g.n(sz),NK=yY.next().value,Dq=yY.next().value,Ls=NK,Wl=Dq,ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ls,"mainVideoEntity",z,op,Xen(G,Wl,A)));Cs=g.n(ij);for(h5=Cs.next();!h5.done;h5=Cs.next())ps=h5.value,Ut={playlistId:A},Xs={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Ut},ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",ps,"mainVideoEntity",0,op,Xs));return Fs.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,ng))}})},edc=function(k,G){var v,Q,A,l;
return g.b(function(f){switch(f.j){case 1:return v=Og(G),g.OA(f,2),Q=g.Hb(G.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.N(f,ckn(k.j,G,k.Y,(A=G.actionMetadata)==null?void 0:(l=A.offlineLoggingData)==null?void 0:l.offlineDeleteReason),5):g.N(f,dpn(Q,k.j,G,k.Y),6);case 6:if(!k.B.X("woffle_enable_main_downloads_library")){f.As(5);break}return g.N(f,ekg(k.j,G.entityKey),5);case 5:g.mc(f,3);break;case 2:return g.t5(f),f.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},YaH=function(k,G,v,Q){var A,l,f,S,O,Z,m;
return g.b(function(t){switch(t.j){case 1:return g.N(t,WqA([G]),2);case 2:return A=t.Z,g.N(t,L1n(k,A[0],v,Q),3);case 3:return l=t.Z,f=l.mainPlaylistEntity,S=l.oWQ,Z=BiA(f,(O=S)==null?void 0:O.avatar),g.OA(t,4),g.N(t,cm(Z),6);case 6:g.mc(t,5);break;case 4:m=g.t5(t),m instanceof Error&&m.message==="Failed to fetch"&&Ag(m.message);case 5:return t.return(A[0].videos)}})},L1n=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u;
return g.b(function(T){switch(T.j){case 1:A=Date.now().toString();v||(v=A);l=G.videos;f=G.playlistId;S=[];O=[];if(l)for(Z=g.n(l),m=Z.next();!m.done;m=Z.next()){t=m.value;J=t.offlineVideoData;if(!J||!J.videoId)throw Ag("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");r=J.videoId;V={videoId:r,playlistId:f};U={id:g.Tz(JSON.stringify(V),"mainPlaylistVideoEntity"),video:g.Tz(r,"mainVideoEntity")};S.push(U);O.push(U.id)}L={key:g.Tz(f,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:v,lastSyncedTimestampMillis:A};e={key:g.Tz(f,"mainPlaylistEntity"),playlistId:f,videos:O,title:G.title,thumbnailStyleData:n7c(G),visibility:g7A(G),downloadState:L.key};G.channel&&(C=G.channel.offlineChannelData,h=CUp(g.Tz(f,"ytMainChannelEntity"),C),e.channelOwner=h.id);((u=e)==null?0:u.entityMetadata)?(e.entityMetadata.offlineLastModifiedTimestampSeconds=G.lastModifiedTimestamp,Q&&(e.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q))):e&&(e.entityMetadata={nextAutoRefreshIntervalSeconds:Q?
String(Q):void 0,offlineLastModifiedTimestampSeconds:G.lastModifiedTimestamp});g.OA(T,2);return g.N(T,K4(k.j,{mode:"readwrite",O7:!0},function(y){var Ac=Rq(y,e,"mainPlaylistEntity"),E=Rq(y,L,"mainPlaylistDownloadStateEntity");Ac=[Ac,E];E=g.n(S);for(var k3=E.next();!k3.done;k3=E.next())Ac.push(Rq(y,k3.value,"mainPlaylistVideoEntity"));h&&Ac.push(Rq(y,h,"ytMainChannelEntity"));return g.cK.all(Ac)}),4);
case 4:g.mc(T,3);break;case 2:throw g.t5(T),Ag("PES failure for playlist"),Error("PES failure for playlist");case 3:return T.return({mainPlaylistEntity:e,oWQ:h,KTV:S})}})},CUp=function(k,G){return{id:k,
channelId:G.channelId,title:G.title,avatar:G.thumbnail}},n7c=function(k){var G=[],v=k.videos;
v&&v.length>0&&G.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:v[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.n(k),v=k.next();!v.done;v=k.next()){var Q=v.value.offlineBundleItemPlaylistData,A=void 0;v=(A=Q)==null?void 0:A.style;A=void 0;Q={collageThumbnail:{coverThumbnail:(A=Q)==null?void 0:A.coverThumbnail}};switch(v){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":G.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:Q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":G.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":G.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":G.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:Q})}}return G},g7A=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Xen=function(k,G,v){G={offlineVideoData:G,
playlistId:v};if(k=g.w(k.actionMetadata,s8A))G.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:G}},NzA=function(k,G,v){this.j=k;
this.B=G;this.Y=v},j8p=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V;
return g.b(function(U){switch(U.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,l=g.w(G.actionMetadata,KU),S=!((f=l)==null?0:f.playlistId),g.OA(U,2),g.N(U,u1A(k,A,void 0,(O=l)==null?void 0:O.offlineVideoData,S),4);case 4:g.mc(U,3);break;case 2:return Z=g.t5(U),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.J$&&Z.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,m,t));case 3:J=1;J=Number(((r=G.actionMetadata)==null?void 0:r.priority)||0)+1;var h=(h=g.w(G.actionMetadata,KU))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;V=CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"playbackData",J,zdH,h);return U.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,[V]))}})},bFn=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e;
return g.b(function(C){switch(C.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,g.N(C,F0(k.j,G.entityKey,"mainVideoEntity"),2);case 2:l=C.Z;if(!l){f=void 0;C.As(3);break}return g.N(C,F0(k.j,l.downloadState,"mainVideoDownloadStateEntity"),4);case 4:f=C.Z;case 3:S=f;if(!l||!S)return C.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.OA(C,5);return g.N(C,u1A(k,A,S.addedTimestampMillis,(Z=g.w(G.actionMetadata,KU))==null?void 0:Z.offlineVideoData),7);case 7:m=1;m=Number(((t=
G.actionMetadata)==null?void 0:t.priority)||0)+1;O=CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A,"playbackData",m,zdH);g.mc(C,6);break;case 5:J=g.t5(C);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")Ag(J.message);else return r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.J$&&J.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,r,V));C.As(6);break}return g.N(C,XU(k.j,A),9);case 9:U=C.Z;h=g.w(G.actionMetadata,KU);if(e=(L=h)==null?void 0:L.playlistId)U.playlistId=e;U.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.N(C,hg(A,k.j,G,k.Y,U),6);case 6:return C.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,O?[O]:void 0))}})},peH=function(k,G){var v,Q,A,l,f,S,O,Z,m,t;
return g.b(function(J){switch(J.j){case 1:return v=Og(G),g.OA(J,2),Q=g.Hb(G.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.N(J,ckn(k.j,G,k.Y,(m=G.actionMetadata)==null?void 0:(t=m.offlineLoggingData)==null?void 0:t.offlineDeleteReason),5):g.N(J,XU(k.j,Q),6);case 6:A=J.Z;l=g.w(G.actionMetadata,KU);if(S=(f=l)==null?void 0:f.playlistId)A.playlistId=S;A.offlineDeleteReason=(O=G.actionMetadata)==null?void 0:(Z=O.offlineLoggingData)==null?void 0:Z.offlineDeleteReason;return g.N(J,hg(Q,k.j,G,k.Y,A),7);
case 7:if(!k.B.X("woffle_enable_main_downloads_library")){J.As(5);break}return g.N(J,ekg(k.j,G.entityKey),5);case 5:g.mc(J,3);break;case 2:return g.t5(J),J.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},u1A=function(k,G,v,Q,A){var l,f,S,O,Z,m;
return g.b(function(t){switch(t.j){case 1:if(l=Q){t.As(2);break}return g.N(t,pj7([G]),3);case 3:f=t.Z,l=f[0];case 2:return g.N(t,W15(k,l,v,A),4);case 4:S=t.Z;O=S.mainVideoEntity;Z=S.channelEntity;g.OA(t,5);var J=Vm(O.thumbnail),r=Vm(Z.avatar);return g.N(t,cm(J.concat(r)),7);case 7:g.mc(t,0);break;case 5:m=g.t5(t),m instanceof Error&&m.message==="Failed to fetch"&&Ag(m.message),g.SH(t)}})},W15=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J,r,V,U,h;
return g.b(function(L){switch(L.j){case 1:v||(v=Date.now().toString());l=(A=G.channel)==null?void 0:A.offlineChannelData;f={id:g.Tz(G.videoId,"ytMainChannelEntity"),channelId:l.channelId,title:l.title,avatar:l.thumbnail};S={key:g.Tz(G.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Tz(G.videoId,"playbackData"),addedTimestampMillis:v,videoDownloadContextEntity:g.Tz(G.videoId,"videoDownloadContextEntity")};O={key:g.Tz(G.videoId,"videoPlaybackPositionEntity"),videoId:G.videoId,lastPlaybackPositionSeconds:"0"};
k.B.X("html5_offline_playback_position_sync")&&(Z={playbackPosition:O.key});m=g.Tz(G.videoId,"mainVideoEntity");t={key:m,videoId:G.videoId,title:G.title,thumbnail:G.thumbnail,localizedStrings:{viewCount:G.shortViewCountText},userState:Z,lengthSeconds:G.lengthSeconds?Number(G.lengthSeconds):void 0,publishedTimestampMillis:G.publishedTimestamp?(Number(G.publishedTimestamp)*1E3).toString():void 0,formattedDescription:G.description,owner:f.id,downloadState:S.key};if(!k.B.X("woffle_enable_main_downloads_library")||
!Q){L.As(2);break}return g.N(L,s6p(k.j,[m]),3);case 3:if(V=L.Z)J=V.mainDownloadsLibraryEntity,r=V.mainDownloadsListEntity;case 2:return h=mpn,U={key:g.Tz(G.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.jA(S,h,U),g.N(L,K4(k.j,{mode:"readwrite",O7:!0},function(e){var C=Rq(e,f,"ytMainChannelEntity"),u=Rq(e,S,"mainVideoDownloadStateEntity"),T=Rq(e,t,"mainVideoEntity");C=[C,u,T];k.B.X("html5_offline_playback_position_sync")&&(u=Rq(e,O,"videoPlaybackPositionEntity"),
C.push(u));J&&(u=Rq(e,J,"mainDownloadsLibraryEntity"),C.push(u));r&&(u=Rq(e,r,"mainDownloadsListEntity"),C.push(u));U&&(e=Rq(e,U,"downloadStatusEntity"),C.push(e));return g.cK.all(C)}),4);
case 4:return L.return({mainVideoEntity:t,channelEntity:f})}})},Iug=function(k,G,v){this.j=k;
this.B=G;this.Y=v},HF7=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql;
return g.b(function(Y3){switch(Y3.j){case 1:return v=Og(G),Q=[],g.N(Y3,p4.getInstance(),2);case 2:A=Y3.Z;if(!A){Y3.As(3);break}return g.N(Y3,A.get("sdois"),4);case 4:return l=Y3.Z,g.N(Y3,(S=A)==null?void 0:S.get("lmqf"),5);case 5:f=Y3.Z;case 3:g.OA(Y3,6);if(l===void 0)throw Error("prefStorage or opt-in state is undefined");O=[];if(l){Y3.As(8);break}return g.N(Y3,MZq(k.j),9);case 9:O=Y3.Z,O.reverse();case 8:if(!O.length){Y3.As(10);break}Z=g.n(O);m=Z.next();case 11:if(m.done){Y3.As(10);break}t=m.value;
if(!t){Y3.As(12);break}J=g.Hb(t).entityId;return g.N(Y3,XU(k.j,J),14);case 14:return r=Y3.Z,r.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.N(Y3,hg(J,k.j,{entityKey:t,actionType:G.actionType},k.Y,r),12);case 12:m=Z.next();Y3.As(11);break;case 10:return g.N(Y3,Tip(l,(V=f)!=null?V:"SD"),16);case 16:return U=Y3.Z,g.N(Y3,hkp(U),17);case 17:h=XjA(U);if(!k.B.X("woffle_enable_main_downloads_library")){Y3.As(18);break}if(l){Y3.As(19);break}return g.N(Y3,ekg(k.j,g.zv),19);case 19:return g.N(Y3,
xpA(k.j,[g.zv]),18);case 18:if((L=h)==null?0:L.length)for(e=g.n(h),C=e.next();!C.done;C=e.next())if(T=u=C.value,y=T.actionType,Ac=T.entityKey,E=T.actionMetadata,y&&Ac&&E&&!g.w(E,yF7)){y==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(E.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(k3=g.w(u.actionMetadata,KU))k3.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",u.actionMetadata=Object.assign({},u.actionMetadata,{mainVideoEntityActionMetadata:k3});Q.push(u)}g.mc(Y3,
7);break;case 6:return iE=g.t5(Y3),Zb="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ql="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",iE instanceof g.J$&&iE.type==="QUOTA_EXCEEDED"&&(Zb="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ql="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y3.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,Zb,Ql));case 7:return Y3.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,Q))}})},TzA=function(){Pm.apply(this,
arguments);
this.hs="mainVideoEntity"},Rdn=function(k,G,v){G=G===void 0?43200:G;
v=v===void 0?!0:v;var Q=Q===void 0?!1:Q;var A,l,f;return g.b(function(S){switch(S.j){case 1:if(!k.G.oF())return S.return([]);A=[];g.OA(S,2);return g.N(S,ykA(G,v,Q),4);case 4:A=S.Z;g.mc(S,3);break;case 2:l=g.t5(S),l instanceof Error&&l.message==="No data"||l instanceof Error&&l.message==="Empty response body"&&Ag(l.message);case 3:return f=UmA(k,A,v,"mainPlaylistEntity"),S.return(f)}})},PU5=function(k,G,v,Q){Q=Q===void 0?!1:Q;
var A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e;return g.b(function(C){switch(C.j){case 1:return A=[],g.N(C,H05(),2);case 2:return(l=C.Z)||Q?g.N(C,Rk7(G,v),3):C.return([]);case 3:f=C.Z;if((S=f)==null||!S.length)return C.return([]);O={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Z=g.n(f);m=Z.next();case 4:if(m.done){C.As(6);break}J=t=m.value;r=J.actionType;V=J.entityKey;U=J.actionMetadata;if(!(r&&V&&U)||g.w(U,yF7)){C.As(5);break}r==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(U.offlineLoggingData=
O);h=g.Hb(V);L=h.entityId;return g.N(C,qP(k,[L],"mainVideoEntity",r,U),8);case 8:e=C.Z,A=A.concat(e);case 5:m=Z.next();C.As(4);break;case 6:return C.return(A)}})},qaH=function(k,G){this.j=k;
this.Y=G},K1H=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L;
return g.b(function(e){switch(e.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,l=[],g.OA(e,2),g.N(e,o7s(k,A),4);case 4:l=e.Z;if((f=l)==null||!f.length){e.As(5);break}return g.N(e,Nic(k.j,G.entityKey),5);case 5:g.mc(e,3);break;case 2:return S=g.t5(e),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.J$&&S.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
e.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,O,Z));case 3:return m=[],g.N(e,tZM(k.j,"musicTrack",l),7);case 7:l=e.Z;if(l.length)for(t=g.n(l),J=t.next();!J.done;J=t.next())if(r=J.value,V=r.offlineVideoData,U=void 0,(U=V)==null?0:U.videoId)h=void 0,L=Number(((h=G.actionMetadata)==null?void 0:h.priority)||0)+1,m.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",L,Da,ee(G,V,A)));return e.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,m))}})},
Dmg=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY,Lg,Y,Gu,Us,ij,D8,Os,Ks,kp,MK,M,c,X,z,q,a7,D,R,p,ns;
return g.b(function(g8){switch(g8.j){case 1:return v=Og(G),Q=G.entityKey,A=g.Hb(Q).entityId,l=[],f=!1,A==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.N(g8,E2(k.j,"musicAlbumRelease"),5)):g.N(g8,F0(k.j,Q,"musicAlbumRelease"),4);case 4:(S=g8.Z)&&l.push(S);g8.As(3);break;case 5:l=g8.Z;case 3:if((O=l)==null||!O.length)return g8.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));if(f){Z=[];m=g.n(l);for(t=m.next();!t.done;t=m.next())J=t.value,r=g.Hb(J.id).entityId,Z.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
r,"musicAlbumRelease",0,Da));return g8.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,Z))}V=[];U=l[0];h=void 0;if(!U.downloadMetadata){g8.As(6);break}return g.N(g8,F0(k.j,U.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:L=g8.Z,h=Number((C=(e=L)==null?void 0:e.addedTimestampMillis)!=null?C:"0")/1E3;case 6:return g.OA(g8,8),g.N(g8,o7s(k,A,(u=h)==null?void 0:u.toString()),10);case 10:V=g8.Z;g.mc(g8,9);break;case 8:T=g.t5(g8);if(!(T instanceof Error&&T.message===
"No data")){if(T instanceof Error&&T.message==="Empty response body")Ag(T.message);else return y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ac="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.J$&&T.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ac="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),g8.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,y,Ac));g8.As(9);break}return g.N(g8,sg(A,"musicAlbumRelease",
k.j,G,k.Y),9);case 9:E=[];k3=new Map;if((iE=V)==null?0:iE.length)for(Zb=g.n(V),Ql=Zb.next();!Ql.done;Ql=Zb.next())Y3=Ql.value,Gn=Y3.offlineVideoData,iA=void 0,((iA=Gn)==null?0:iA.videoId)&&k3.set(Gn.videoId,Gn);fg=new Map;R7=[];if((o7=U)==null?0:(Kg=o7.tracks)==null?0:Kg.length)for(ng=g.n(U.tracks),x=ng.next();!x.done;x=ng.next())if(wA=x.value,qw=g.Hb(wA).entityId)k3.has(qw)?(fg.set(qw,k3.get(qw)),k3.delete(qw)):R7.push(qw);Lg=Number(((SY=G.actionMetadata)==null?void 0:SY.priority)||0)+1;Y=g.n(k3.entries());
for(Gu=Y.next();!Gu.done;Gu=Y.next())Us=Gu.value,ij=g.n(Us),D8=ij.next().value,Os=ij.next().value,Ks=D8,kp=Os,E.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ks,"musicTrack",Lg,Da,ee(G,kp)));MK=g.n(fg.entries());for(M=MK.next();!M.done;M=MK.next())c=M.value,X=g.n(c),z=X.next().value,q=X.next().value,a7=z,D=q,E.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a7,"musicTrack",Lg,Da,ee(G,D)));R=g.n(R7);for(p=R.next();!p.done;p=R.next())ns=p.value,E.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ns,"musicTrack",0,Da));return g8.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,E))}})},F1A=function(k,G){var v,Q;
return g.b(function(A){switch(A.j){case 1:return v=Og(G),g.OA(A,2),Q=g.Hb(G.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.N(A,x2(k.j,G,k.Y),5):g.N(A,sg(Q,"musicAlbumRelease",k.j,G,k.Y),6);case 6:return g.N(A,u6c(k.j,G.entityKey),5);case 5:g.mc(A,3);break;case 2:return g.t5(A),A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},o7s=function(k,G,v){var Q,A,l;
return g.b(function(f){switch(f.j){case 1:return g.N(f,WqA([G]),2);case 2:return Q=f.Z,g.N(f,E7g(k,Q[0],v),3);case 3:return A=f.Z,l=Vm(A.thumbnailDetails),g.N(f,cm(l),4);case 4:return f.return(Q[0].videos)}})},E7g=function(k,G,v){var Q,A,l,f,S,O,Z,m,t,J,r,V,U,h;
return g.b(function(L){if(L.j==1){Q=G.additionalMetadadatas;A=void 0;if(Q&&Q.length>0)for(l=g.n(Q),f=l.next();!f.done;f=l.next())if(S=f.value,S.offlineMusicPlaylistData){A=S.offlineMusicPlaylistData;break}O=G.playlistId;Z=zkH(G);m=Z.Qt;t=Z.p$;J=v?(Number(v)*1E3).toString():Date.now().toString();r=G.lastModifiedTimestamp?(Number(G.lastModifiedTimestamp)*1E3).toString():"0";V={id:g.Tz(O,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:t,lastModifiedTimestampMillis:r,addedTimestampMillis:J,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};U={id:g.Tz(O,"musicAlbumRelease"),title:G.title,audioPlaylistId:O,trackCount:G.totalVideoCount,tracks:m,downloadMetadata:V.id};A&&(U.thumbnailDetails=(h=A.albumHqThumbnail)!=null?h:A.albumArtistThumbnail,U.artistDisplayName=A.albumArtistDisplayName,U.releaseDate=A.albumReleaseDate,U.contentRating={explicitType:A.albumReleaseExplicitType},U.releaseType=A.albumReleaseType);return g.N(L,K4(k.j,{mode:"readwrite",O7:!0},function(e){var C=Rq(e,U,"musicAlbumRelease");
e=Rq(e,V,"musicAlbumReleaseDownloadMetadataEntity");return g.cK.all([C,e])}),2)}return L.return(U)})},kAA=function(k,G){this.j=k;
this.Y=G},v0q=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L;
return g.b(function(e){switch(e.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,l=[],g.OA(e,2),g.N(e,GAc(k,A),4);case 4:l=e.Z;if((f=l)==null||!f.length){e.As(5);break}return g.N(e,Nic(k.j,G.entityKey),5);case 5:g.mc(e,3);break;case 2:return S=g.t5(e),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.J$&&S.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
e.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,O,Z));case 3:return m=[],g.N(e,tZM(k.j,"musicTrack",l),7);case 7:l=e.Z;if(l.length)for(t=g.n(l),J=t.next();!J.done;J=t.next())if(r=J.value,V=r.offlineVideoData,U=void 0,(U=V)==null?0:U.videoId)h=void 0,L=Number(((h=G.actionMetadata)==null?void 0:h.priority)||0)+1,m.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",L,FU,ee(G,V,A)));return e.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,m))}})},
QXc=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x,wA,qw,SY,Lg,Y,Gu,Us,ij,D8,Os,Ks,kp,MK,M,c,X,z,q,a7,D,R,p,ns,g8,w8,eY,Qn,sz,yY,NK,Dq,Ls,Wl,Cs,h5;
return g.b(function(ps){switch(ps.j){case 1:return v=Og(G),Q=G.entityKey,A=g.Hb(Q).entityId,l=[],f=!1,A==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.N(ps,E2(k.j,"musicPlaylist"),5)):g.N(ps,F0(k.j,Q,"musicPlaylist"),4);case 4:(S=ps.Z)&&l.push(S);ps.As(3);break;case 5:l=ps.Z;case 3:if((O=l)==null||!O.length)return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));Z=g.w(G.actionMetadata,j6A);t=(m=Z)==null?void 0:m.autoSync;J=[];V=r=!0;U=!1;h=void 0;if(!f&&t===!1){ps.As(6);break}g.OA(ps,7);return g.N(ps,
P9H(0,!!t,!0,l),9);case 9:J=ps.Z;g.mc(ps,8);break;case 7:L=g.t5(ps);if(!(L instanceof Error&&L.message==="No data")){L instanceof Error&&L.message==="Empty response body"&&Ag(L.message);ps.As(8);break}return A==="!*$_ALL_ENTITIES_!*$"?g.N(ps,x2(k.j,G,k.Y),8):g.N(ps,sg(A,"musicPlaylist",k.j,G,k.Y),8);case 8:if(!J.length||!f&&J[0].playlistId!==A)return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));case 6:if(f){e=[];C=g.n(J);for(u=C.next();!u.done;u=C.next())T=u.value,T.upToDate||
t&&!T.shouldAutoSyncMetadata||!T.playlistId||(y={autoSync:t},e.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T.playlistId,"musicPlaylist",0,FU,{musicPlaylistEntityActionMetadata:y})));return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,e))}J.length&&(Ac=J[0],U=!!Ac.upToDate,t&&(r=(E=Ac.shouldAutoSyncMetadata)!=null?E:!0,V=(k3=Ac.shouldAutoSyncVideos)!=null?k3:!0,Ac.checkInSeconds&&(h=Ac.checkInSeconds)));if(U||!r)return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));iE=[];Zb=l[0];Ql=void 0;if(!Zb.downloadMetadata){ps.As(15);break}return g.N(ps,F0(k.j,Zb.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Y3=ps.Z,Ql=Number((iA=(Gn=Y3)==null?void 0:Gn.addedTimestampMillis)!=null?iA:"0")/1E3;case 15:return g.OA(ps,17),g.N(ps,GAc(k,A,(fg=Ql)==null?void 0:fg.toString(),h),19);case 19:iE=ps.Z;g.mc(ps,18);break;case 17:R7=g.t5(ps);if(!(R7 instanceof Error&&R7.message==="No data")){if(R7 instanceof Error&&R7.message==="Empty response body")Ag(R7.message);
else return o7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R7 instanceof g.J$&&R7.type==="QUOTA_EXCEEDED"&&(o7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,o7,Kg));ps.As(18);break}return g.N(ps,sg(A,"musicPlaylist",k.j,G,k.Y),18);case 18:if(!V)return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));ng=[];x=new Map;if((wA=iE)==null?0:wA.length)for(qw=g.n(iE),SY=qw.next();!SY.done;SY=qw.next())Lg=SY.value,Y=Lg.offlineVideoData,Gu=void 0,((Gu=Y)==null?0:Gu.videoId)&&x.set(Y.videoId,Y);Us=new Map;ij=[];if((D8=Zb)==null?0:(Os=D8.tracks)==null?0:Os.length)for(Ks=g.n(Zb.tracks),kp=Ks.next();!kp.done;kp=Ks.next())if(MK=kp.value,M=g.Hb(MK).entityId)x.has(M)?(Us.set(M,x.get(M)),x.delete(M)):ij.push(M);X=Number(((c=G.actionMetadata)==null?void 0:c.priority)||0)+1;z=g.n(x.entries());for(q=z.next();!q.done;q=
z.next())a7=q.value,D=g.n(a7),R=D.next().value,p=D.next().value,ns=R,g8=p,ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ns,"musicTrack",X,FU,ee(G,g8)));w8=g.n(Us.entries());for(eY=w8.next();!eY.done;eY=w8.next())Qn=eY.value,sz=g.n(Qn),yY=sz.next().value,NK=sz.next().value,Dq=yY,Ls=NK,ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Dq,"musicTrack",X,FU,ee(G,Ls)));Wl=g.n(ij);for(Cs=Wl.next();!Cs.done;Cs=Wl.next())h5=Cs.value,ng.push(CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",h5,"musicTrack",
0,FU));return ps.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,ng))}})},AwH=function(k,G){var v,Q;
return g.b(function(A){switch(A.j){case 1:return v=Og(G),g.OA(A,2),Q=g.Hb(G.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.N(A,x2(k.j,G,k.Y),5):g.N(A,sg(Q,"musicPlaylist",k.j,G,k.Y),6);case 6:return g.N(A,u6c(k.j,G.entityKey),5);case 5:g.mc(A,3);break;case 2:return g.t5(A),A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},GAc=function(k,G,v,Q){var A,l,f;
return g.b(function(S){switch(S.j){case 1:return g.N(S,WqA([G]),2);case 2:return A=S.Z,g.N(S,lyp(k,A[0],v,Q),3);case 3:return l=S.Z,f=Vm(l.thumbnailDetails),g.N(S,cm(f),4);case 4:return S.return(A[0].videos)}})},lyp=function(k,G,v,Q){var A,l,f,S,O,Z,m,t,J;
return g.b(function(r){return r.j==1?(A=G.playlistId,l=zkH(G),f=l.Qt,S=l.p$,O=v?(Number(v)*1E3).toString():Date.now().toString(),Z=G.lastModifiedTimestamp?(Number(G.lastModifiedTimestamp)*1E3).toString():"0",m={id:g.Tz(A,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:Z,addedTimestampMillis:O,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},t={id:g.Tz(A,"musicPlaylist"),title:G.title,playlistId:A,thumbnailDetails:G.thumbnail,visibility:fyH(G),trackCount:G.totalVideoCount,
tracks:f,downloadMetadata:m.id},Q&&(((J=t)==null?0:J.entityMetadata)?t.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:String(Q)})),g.N(r,K4(k.j,{mode:"readwrite",O7:!0},function(V){var U=Rq(V,t,"musicPlaylist");V=Rq(V,m,"musicPlaylistDownloadMetadataEntity");return g.cK.all([U,V])}),2)):r.return(t)})},fyH=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},ay7=function(k,G){this.j=k;
this.Y=G},ZTH=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V;
return g.b(function(U){switch(U.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,l=g.w(G.actionMetadata,iTA),g.OA(U,2),g.N(U,Sv7(k,A,void 0,(f=l)==null?void 0:f.track,(S=l)==null?void 0:S.albumRelease),4);case 4:if((O=l)==null?0:O.playlistId){U.As(5);break}return g.N(U,Nic(k.j,G.entityKey),5);case 5:g.mc(U,3);break;case 2:return Z=g.t5(U),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.J$&&Z.type==="QUOTA_EXCEEDED"&&
(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),U.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,m,t));case 3:r=Number(((J=G.actionMetadata)==null?void 0:J.priority)||0)+1;var h=(h=g.w(G.actionMetadata,iTA))?{playbackDataActionMetadata:{maximumDownloadQuality:h.maximumDownloadQuality}}:void 0;V=CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"playbackData",r,OTn,h);return U.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v,[V]))}})},m6A=function(k,G){var v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h;
return g.b(function(L){switch(L.j){case 1:return v=Og(G),Q=g.Hb(G.entityKey),A=Q.entityId,g.N(L,F0(k.j,G.entityKey,"musicTrack"),2);case 2:l=L.Z;if(!l){f=void 0;L.As(3);break}return g.N(L,F0(k.j,l.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:f=L.Z;case 3:S=f;if(!l||!S)return L.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));Z=g.w(G.actionMetadata,iTA);g.OA(L,5);return g.N(L,Sv7(k,A,S.addedTimestampMillis,(m=Z)==null?void 0:m.track,(t=Z)==null?void 0:t.albumRelease),
7);case 7:r=Number(((J=G.actionMetadata)==null?void 0:J.priority)||0)+1;O=CU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A,"playbackData",r,OTn);g.mc(L,6);break;case 5:V=g.t5(L);if(!(V instanceof Error&&V.message==="No data")){if(V instanceof Error&&V.message==="Empty response body")Ag(V.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.J$&&V.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,U,h));L.As(6);break}return g.N(L,MP(A,k.j,G,k.Y),6);case 6:return L.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,O?[O]:void 0))}})},tv5=function(k,G){var v,Q;
return g.b(function(A){switch(A.j){case 1:return v=Og(G),g.OA(A,2),Q=g.Hb(G.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.N(A,x2(k.j,G,k.Y),5):g.N(A,MP(Q,k.j,G,k.Y),6);case 6:return g.N(A,u6c(k.j,G.entityKey),5);case 5:g.mc(A,3);break;case 2:return g.t5(A),A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new NP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},Sv7=function(k,G,v,Q,A){var l,f,S,O,Z,m;
return g.b(function(t){switch(t.j){case 1:if(l=Q){t.As(2);break}return g.N(t,pj7([G]),3);case 3:f=t.Z,S=f[0],l=C9A(S);case 2:return g.N(t,$6s(k,l,G,A,v),4);case 4:O=t.Z;Z=O.musicTrackEntity;m=O.Ud;var J=Vm(Z.thumbnailDetails),r=[];m&&(r=Vm(m.thumbnailDetails));return g.N(t,cm(J.concat(r)),0)}})},$6s=function(k,G,v,Q,A){var l;
return g.b(function(f){return f.j==1?(A||(A=Date.now().toString()),l={id:g.Tz(v,"musicTrackDownloadMetadataEntity"),playbackData:g.Tz(v,"playbackData"),addedTimestampMillis:A,videoDownloadContextEntity:g.Tz(v,"videoDownloadContextEntity")},Q&&(G.albumRelease=Q.id),g.N(f,K4(k.j,{mode:"readwrite",O7:!0},function(S){var O=[],Z=Rq(S,l,"musicTrackDownloadMetadataEntity");O.push(Z);Z=Rq(S,G,"musicTrack");O.push(Z);Q&&(S=Rq(S,Q,"musicAlbumRelease"),O.push(S));return g.cK.all(O)}),2)):f.j!=3?g.N(f,$2(v,"musicTrackDownloadMetadataEntity",
k.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):f.return({musicTrackEntity:G,
Ud:Q})})},Eg=function(){Pm.apply(this,arguments);
this.hs="musicTrack"},Jww=function(k,G,v){G=G===void 0?43200:G;
v=v===void 0?!0:v;var Q=Q===void 0?!1:Q;var A,l;return g.b(function(f){switch(f.j){case 1:if(!k.G.oF())return f.return([]);A=[];g.OA(f,2);return g.N(f,P9H(G,v,Q),4);case 4:A=f.Z;g.mc(f,3);break;case 2:g.t5(f);case 3:return l=UmA(k,A,v,"musicPlaylist"),f.return(l)}})},rwg=function(){g.Jm.apply(this,arguments);
var k=this;this.events=new g.Z1(this);this.B=this.player.K();this.hB={I8h:function(){return k.j},
f5:function(){return k.f5()},
vI:function(G){return k.vI(G)}}},Vvg=function(k){var G;
k=g.w((G=k.getWatchNextResponse())==null?void 0:G.currentVideoEndpoint,g.i3);if(k==null?0:k.playlistId)var v=k.playlistId;return v},BL7=function(k,G){var v,Q,A,l;
return g.b(function(f){if(f.j==1){v=G.clientPlaybackNonce;Q={cpn:v,offlineSourceVisualElement:g.V8(G.Z$||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};G.Z&&(Q.videoFmt=Number(G.Z.itag));G.V&&(Q.audioFmt=Number(G.V.itag));if((A=Vvg(G))&&G.videoId){var S=G.videoId;S=A!=="PPSV"?Promise.resolve(!1):k.j.Bb(S);f=g.N(f,S,3)}else f=f.As(2);return f}f.j!=2&&(l=f.Z)&&(Q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.Z=v;g.J7("offlinePlaybackStarted",Q);g.SH(f)})};
g.nS.prototype.vv=g.Wp(45,function(k){return this.app.vv(k)});
g.JE.prototype.vv=g.Wp(44,function(k){return g.wQ8(this,9,k)});
g.d(jO,zO);g.Tu.Object.defineProperties(jO.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(k){this.j.entityMetadata=k}}});
g.d(ljs,jO);ljs.prototype.Z=function(){return[]};
g.d(fjs,jO);fjs.prototype.Z=function(){return[]};
g.d(ajM,jO);ajM.prototype.Z=function(){return[]};
g.d(i6s,jO);i6s.prototype.Z=function(){return[]};
g.d(SBp,jO);SBp.prototype.Z=function(){return[]};
g.d(O6A,jO);O6A.prototype.Z=function(){var k=[];this.j.alternateChannel&&k.push(this.j.alternateChannel);this.j.alternateChannelList&&k.push.apply(k,g.Db(this.j.alternateChannelList));this.j.oneofChannelEntity&&k.push(this.j.oneofChannelEntity);return[].concat(g.Db(new Set(k)))};
g.d(Z6n,jO);Z6n.prototype.Z=function(){var k=[];this.j.entryCollection&&k.push(this.j.entryCollection);return[].concat(g.Db(new Set(k)))};
g.d(mCw,zO);mCw.prototype.Z=function(){var k=[];this.j.video&&k.push(this.j.video);return[].concat(g.Db(new Set(k)))};
g.d(tPH,jO);tPH.prototype.Z=function(){var k=[];this.j.parentPlaylist&&k.push(this.j.parentPlaylist);if(this.j.entries)for(var G=g.n(this.j.entries),v=G.next();!v.done;v=G.next())k.push.apply(k,g.Db((new mCw(v.value)).Z()));return[].concat(g.Db(new Set(k)))};
g.d($C5,jO);$C5.prototype.Z=function(){var k=[];this.j.descriptionEntity&&k.push(this.j.descriptionEntity);this.j.creators&&k.push.apply(k,g.Db(this.j.creators));this.j.theBiggestFan&&k.push(this.j.theBiggestFan);return[].concat(g.Db(new Set(k)))};
g.d(JAA,jO);JAA.prototype.Z=function(){return[]};
g.d(rAn,jO);rAn.prototype.Z=function(){return[]};
g.d(VPH,jO);VPH.prototype.Z=function(){return[]};
g.d(BPc,jO);BPc.prototype.Z=function(){return[]};
g.d(wDw,jO);wDw.prototype.Z=function(){return[]};
g.d(dCg,jO);dCg.prototype.Z=function(){return[]};
g.d(UCg,jO);UCg.prototype.Z=function(){return[]};
g.d(cAH,jO);cAH.prototype.Z=function(){return[]};
g.d(h5n,jO);h5n.prototype.Z=function(){return[]};
g.d(YBw,jO);YBw.prototype.Z=function(){var k=[];this.j.downloadsList&&k.push(this.j.downloadsList);this.j.smartDownloadsList&&k.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&k.push(this.j.recommendedDownloadsList);this.j.refresh&&k.push(this.j.refresh);return[].concat(g.Db(new Set(k)))};
g.d(XDw,zO);XDw.prototype.Z=function(){var k=[];this.j.video&&k.push(this.j.video);this.j.playlist&&k.push(this.j.playlist);this.j.videoItem&&k.push(this.j.videoItem);this.j.playlistItem&&k.push(this.j.playlistItem);return[].concat(g.Db(new Set(k)))};
g.d(MPA,jO);MPA.prototype.Z=function(){var k=[];this.j.refresh&&k.push(this.j.refresh);if(this.j.downloads)for(var G=g.n(this.j.downloads),v=G.next();!v.done;v=G.next())k.push.apply(k,g.Db((new XDw(v.value)).Z()));return[].concat(g.Db(new Set(k)))};
g.d(s$p,jO);s$p.prototype.Z=function(){var k=[];this.j.localImageEntities&&k.push.apply(k,g.Db(this.j.localImageEntities));return[].concat(g.Db(new Set(k)))};
g.d(xCA,jO);xCA.prototype.Z=function(){var k=[];this.j.playbackData&&k.push(this.j.playbackData);this.j.localImageEntities&&k.push.apply(k,g.Db(this.j.localImageEntities));this.j.videoDownloadContextEntity&&k.push(this.j.videoDownloadContextEntity);return[].concat(g.Db(new Set(k)))};
g.d(e5g,jO);e5g.prototype.Z=function(){return[]};
g.d(LVs,jO);LVs.prototype.Z=function(){var k=[];this.j.fakeChildren&&k.push.apply(k,g.Db(this.j.fakeChildren));return[].concat(g.Db(new Set(k)))};
g.d(nGc,jO);nGc.prototype.Z=function(){var k=[];this.j.video&&k.push(this.j.video);this.j.playbackData&&k.push(this.j.playbackData);this.j.offlineVideoPolicy&&k.push(this.j.offlineVideoPolicy);return[].concat(g.Db(new Set(k)))};
g.d(gGA,jO);gGA.prototype.Z=function(){return[]};
g.d(CMA,jO);CMA.prototype.Z=function(){var k=[];this.j.channelOwner&&k.push(this.j.channelOwner);this.j.videos&&k.push.apply(k,g.Db(this.j.videos));this.j.collaboratorChannels&&k.push.apply(k,g.Db(this.j.collaboratorChannels));this.j.downloadState&&k.push(this.j.downloadState);this.j.refresh&&k.push(this.j.refresh);return[].concat(g.Db(new Set(k)))};
g.d(NPp,jO);NPp.prototype.Z=function(){var k=[];this.j.video&&k.push(this.j.video);this.j.channelContributor&&k.push(this.j.channelContributor);return[].concat(g.Db(new Set(k)))};
g.d(uK5,zO);uK5.prototype.Z=function(){var k=[];this.j.localImageEntities&&k.push.apply(k,g.Db(this.j.localImageEntities));this.j.videoDownloadContextEntity&&k.push(this.j.videoDownloadContextEntity);return[].concat(g.Db(new Set(k)))};
g.d(z5p,zO);z5p.prototype.Z=function(){var k=[];this.j.recommendedVideoMetadata&&k.push.apply(k,g.Db((new uK5(this.j.recommendedVideoMetadata)).Z()));return[].concat(g.Db(new Set(k)))};
g.d(j$A,zO);j$A.prototype.Z=function(){var k=[];this.j.playbackPosition&&k.push(this.j.playbackPosition);return[].concat(g.Db(new Set(k)))};
g.d(b67,jO);b67.prototype.Z=function(){var k=[];this.j.owner&&k.push(this.j.owner);this.j.downloadState&&k.push(this.j.downloadState);this.j.userState&&k.push.apply(k,g.Db((new j$A(this.j.userState)).Z()));this.j.additionalMetadata&&k.push.apply(k,g.Db((new z5p(this.j.additionalMetadata)).Z()));return[].concat(g.Db(new Set(k)))};
g.d(pDn,jO);pDn.prototype.Z=function(){var k=[];this.j.userChannelDetails&&k.push(this.j.userChannelDetails);return[].concat(g.Db(new Set(k)))};
g.d(WVA,jO);WVA.prototype.Z=function(){var k=[];this.j.channelOwner&&k.push(this.j.channelOwner);this.j.playbackPosition&&k.push(this.j.playbackPosition);this.j.localImageEntities&&k.push.apply(k,g.Db(this.j.localImageEntities));this.j.downloadStatus&&k.push(this.j.downloadStatus);return[].concat(g.Db(new Set(k)))};
g.d(Ij5,jO);Ij5.prototype.Z=function(){return[]};
g.d(yAq,jO);yAq.prototype.Z=function(){return[]};
g.d(H6g,jO);H6g.prototype.Z=function(){return[]};
g.d(TPH,jO);TPH.prototype.Z=function(){return[]};
g.d(R5n,jO);R5n.prototype.Z=function(){return[]};
g.d(PMn,jO);PMn.prototype.Z=function(){return[]};
g.d(qB5,jO);qB5.prototype.Z=function(){return[]};
g.d(oGA,jO);oGA.prototype.Z=function(){return[]};
g.d(KVn,jO);KVn.prototype.Z=function(){return[]};
g.d(DCs,jO);DCs.prototype.Z=function(){return[]};
g.d(FVH,jO);FVH.prototype.Z=function(){return[]};
g.d(EGg,jO);EGg.prototype.Z=function(){return[]};
g.d(kWq,jO);kWq.prototype.Z=function(){return[]};
g.d(GWn,jO);GWn.prototype.Z=function(){var k=[];this.j.compositeSourceKeys&&k.push.apply(k,g.Db(this.j.compositeSourceKeys));return[].concat(g.Db(new Set(k)))};
g.d(v6c,jO);v6c.prototype.Z=function(){var k=[];this.j.trackDownloadMetadatas&&k.push.apply(k,g.Db(this.j.trackDownloadMetadatas));return[].concat(g.Db(new Set(k)))};
g.d(QYM,jO);
QYM.prototype.Z=function(){var k=[];this.j.downloadedTracks&&k.push.apply(k,g.Db(this.j.downloadedTracks));this.j.smartDownloadedTracks&&k.push.apply(k,g.Db(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&k.push.apply(k,g.Db(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&k.push.apply(k,g.Db(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&k.push.apply(k,g.Db(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&k.push.apply(k,g.Db(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
k.push.apply(k,g.Db(this.j.smartDownloadedPlaylists));this.j.metadataOnlyTracks&&k.push.apply(k,g.Db(this.j.metadataOnlyTracks));return[].concat(g.Db(new Set(k)))};
g.d(Auc,jO);Auc.prototype.Z=function(){var k=[];this.j.trackDownloadMetadatas&&k.push.apply(k,g.Db(this.j.trackDownloadMetadatas));return[].concat(g.Db(new Set(k)))};
g.d(lMH,jO);lMH.prototype.Z=function(){var k=[];this.j.playbackData&&k.push(this.j.playbackData);this.j.localImageEntities&&k.push.apply(k,g.Db(this.j.localImageEntities));this.j.videoDownloadContextEntity&&k.push(this.j.videoDownloadContextEntity);return[].concat(g.Db(new Set(k)))};
g.d(fMq,jO);fMq.prototype.Z=function(){var k=[];this.j.musicLibraryStatusEntity&&k.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&k.push.apply(k,g.Db(this.j.primaryArtists));this.j.details&&k.push(this.j.details);this.j.userDetails&&k.push(this.j.userDetails);this.j.tracks&&k.push.apply(k,g.Db(this.j.tracks));this.j.share&&k.push(this.j.share);this.j.downloadMetadata&&k.push(this.j.downloadMetadata);this.j.refresh&&k.push(this.j.refresh);return[].concat(g.Db(new Set(k)))};
g.d(aMH,jO);aMH.prototype.Z=function(){var k=[];this.j.albumRelease&&k.push(this.j.albumRelease);this.j.tracks&&k.push.apply(k,g.Db(this.j.tracks));return[].concat(g.Db(new Set(k)))};
g.d(ixA,jO);ixA.prototype.Z=function(){var k=[];this.j.albumRelease&&k.push(this.j.albumRelease);return[].concat(g.Db(new Set(k)))};
g.d(SEA,jO);SEA.prototype.Z=function(){var k=[];this.j.details&&k.push(this.j.details);this.j.userDetails&&k.push(this.j.userDetails);return[].concat(g.Db(new Set(k)))};
g.d(Oxn,jO);Oxn.prototype.Z=function(){var k=[];this.j.parentArtist&&k.push(this.j.parentArtist);return[].concat(g.Db(new Set(k)))};
g.d(Zxn,jO);Zxn.prototype.Z=function(){var k=[];this.j.parentArtist&&k.push(this.j.parentArtist);return[].concat(g.Db(new Set(k)))};
g.d(mG7,jO);mG7.prototype.Z=function(){return[]};
g.d(tIg,jO);tIg.prototype.Z=function(){return[]};
g.d($Gq,zO);$Gq.prototype.Z=function(){var k=[];this.j.creatorEntity&&k.push(this.j.creatorEntity);return[].concat(g.Db(new Set(k)))};
g.d(JuA,jO);
JuA.prototype.Z=function(){var k=[];this.j.tracks&&k.push.apply(k,g.Db(this.j.tracks));this.j.refresh&&k.push(this.j.refresh);this.j.musicLibraryStatusEntity&&k.push(this.j.musicLibraryStatusEntity);this.j.details&&k.push(this.j.details);this.j.downloadMetadata&&k.push(this.j.downloadMetadata);this.j.sideloadMetadata&&k.push(this.j.sideloadMetadata);this.j.userDetails&&k.push(this.j.userDetails);this.j.entryCollection&&k.push(this.j.entryCollection);this.j.share&&k.push(this.j.share);this.j.podcastShowAdditionalMetadata&&
k.push.apply(k,g.Db((new $Gq(this.j.podcastShowAdditionalMetadata)).Z()));return[].concat(g.Db(new Set(k)))};
g.d(ruw,jO);ruw.prototype.Z=function(){return[]};
g.d(VIn,jO);
VIn.prototype.Z=function(){var k=[];this.j.musicLibraryStatusEntity&&k.push(this.j.musicLibraryStatusEntity);this.j.artists&&k.push.apply(k,g.Db(this.j.artists));this.j.audioModeVersion&&k.push(this.j.audioModeVersion);this.j.videoModeVersion&&k.push(this.j.videoModeVersion);this.j.userDetails&&k.push(this.j.userDetails);this.j.details&&k.push(this.j.details);this.j.albumRelease&&k.push(this.j.albumRelease);this.j.share&&k.push(this.j.share);this.j.libraryEdit&&k.push(this.j.libraryEdit);this.j.downloadMetadata&&
k.push(this.j.downloadMetadata);this.j.playbackPosition&&k.push(this.j.playbackPosition);this.j.lyrics&&k.push(this.j.lyrics);return[].concat(g.Db(new Set(k)))};
g.d(Bfp,jO);Bfp.prototype.Z=function(){var k=[];this.j.parentTrack&&k.push(this.j.parentTrack);return[].concat(g.Db(new Set(k)))};
g.d(w$n,jO);w$n.prototype.Z=function(){var k=[];this.j.parentTrack&&k.push(this.j.parentTrack);return[].concat(g.Db(new Set(k)))};
g.d(dGg,jO);dGg.prototype.Z=function(){return[]};
g.d(UGg,jO);UGg.prototype.Z=function(){return[]};
g.d(cuA,jO);cuA.prototype.Z=function(){return[]};
g.d(h8M,jO);h8M.prototype.Z=function(){return[]};
g.d(YEn,jO);YEn.prototype.Z=function(){var k=[];this.j.transfer&&k.push(this.j.transfer);this.j.adsPlaybackData&&k.push.apply(k,g.Db(this.j.adsPlaybackData));this.j.drmLicense&&k.push(this.j.drmLicense);this.j.offlineVideoPolicy&&k.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&k.push(this.j.videoDownloadContextEntity);return[].concat(g.Db(new Set(k)))};
g.d(X$p,jO);X$p.prototype.Z=function(){return[]};
g.d(MIA,jO);MIA.prototype.Z=function(){var k=[];this.j.offlineVideoStreams&&k.push.apply(k,g.Db(this.j.offlineVideoStreams));this.j.captionTrack&&k.push.apply(k,g.Db(this.j.captionTrack));return[].concat(g.Db(new Set(k)))};
g.d(sYH,jO);sYH.prototype.Z=function(){return[]};
g.d(xGn,jO);xGn.prototype.Z=function(){return[]};
g.d(e8A,jO);e8A.prototype.Z=function(){return[]};
g.d(LtA,jO);LtA.prototype.Z=function(){return[]};
g.d(n6s,jO);n6s.prototype.Z=function(){return[]};
g.d(g6H,jO);g6H.prototype.Z=function(){return[]};
g.d(CGn,jO);CGn.prototype.Z=function(){return[]};
g.d(Nf5,jO);Nf5.prototype.Z=function(){return[]};
g.d(uJA,jO);uJA.prototype.Z=function(){return[]};
g.d(z8p,jO);z8p.prototype.Z=function(){return[]};
g.d(jYq,jO);jYq.prototype.Z=function(){return[]};
g.d(bxc,jO);bxc.prototype.Z=function(){return[]};
g.d(p$H,jO);p$H.prototype.Z=function(){return[]};
g.d(WtA,jO);WtA.prototype.Z=function(){return[]};
g.d(IMp,jO);IMp.prototype.Z=function(){return[]};
g.d(yu5,jO);yu5.prototype.Z=function(){return[]};
g.d(HxA,jO);HxA.prototype.Z=function(){return[]};
g.d(Tfg,jO);Tfg.prototype.Z=function(){return[]};
g.d(R8g,jO);R8g.prototype.Z=function(){return[]};
g.d(PGA,jO);PGA.prototype.Z=function(){return[]};
g.d(qEA,jO);qEA.prototype.Z=function(){return[]};
g.d(o6A,jO);o6A.prototype.Z=function(){return[]};
var qwg=["browse","music/browse","streaming_browse","unplugged/browse"],Ewn=["offline/playlist_sync_check"],b0A=["offline"],own=["offline/offline_video_playback_position_sync"],Dpn=["offline/get_playback_data_entity"],bi;p4.getInstance=function(){return g.b(function(k){return k.return(new Promise(function(G){g.k_().then(function(v){v?(p4.instance||(p4.instance=new p4(v)),G(p4.instance)):G(void 0)})}))})};
p4.prototype.get=function(k){var G=this,v,Q,A;return g.b(function(l){if(l.j==1)return g.N(l,E65(G.token),2);if(l.j!=3)return v=l.Z,g.N(l,v.get("prefs",k),3);Q=l.Z;if(!Q)return l.return();A=(0,g.MR)();return Q.expirationTimestampMs<=A?l.return():l.return(Q.value)})};
p4.prototype.set=function(k,G,v){v=v===void 0?31536E3:v;var Q=this,A,l,f;return g.b(function(S){if(S.j==1)return A=(0,g.MR)(),l={key:k,value:G,expirationTimestampMs:A+v*1E3},g.N(S,E65(Q.token),2);f=S.Z;return g.N(S,g.Ci(f,"prefs",l),0)})};
p4.prototype.remove=function(k){var G=this,v;return g.b(function(Q){if(Q.j==1)return g.N(Q,E65(G.token),2);v=Q.Z;return g.N(Q,v.delete("prefs",k),0)})};
g.d(Wg,g.zu);g.d(Iq,ASA);Iq.prototype.Y=function(k,G){G=f5A(G);k=(new TextEncoder).encode(JSON.stringify(k));return this.j.encrypt(k,G)};
Iq.prototype.Z=function(k,G){if(!(k instanceof Uint8Array))throw koA(1);var v=new TextDecoder;G=f5A(G);k=this.j.decrypt(k,G);return JSON.parse(v.decode(k))};
var a5A={accountLinkStatusEntity:VPH,booleanEntity:i6s,buttonEntity:IMp,captionTrack:dGg,channelHandle:ljs,chipEntity:CGn,commerceAcquisitionClientPayloadEntity:HxA,commerceCartListEntity:Tfg,compositeSourceEntity:kWq,multiviewStagingEntity:GWn,contextNoteFeedEntityPayload:fjs,contextNoteUserRatingEntityPayload:ajM,continuationTokenEntity:gGA,downloadQualityPickerEntity:UCg,downloadsPageRefreshTokenEntity:h5n,downloadsPageViewConfigurationEntity:Ij5,downloadStatusEntity:cAH,dismissState:Nf5,sfvAudioItemCurrentlyPlayingEntity:LtA,
emojiFountainDataEntity:p$H,emojiCustomizationSetEntity:bxc,fakeChannel:O6A,fakePlaylist:Z6n,fakePlaylistEntryCollection:tPH,fakeVideo:$C5,fakeVideoDescription:JAA,featuredProductsEntity:DCs,flowStateEntity:rAn,iconBadgeEntity:R8g,interstitialInteractionStateEntity:wDw,likeButtonAnimationEntity:yAq,liveChatPollStateEntity:dCg,dataFreshnessEntity:jYq,liveViewerLeaderboardChatEntryPointStateEntity:xGn,liveViewerLeaderboardPointsEntity:e8A,liveReactionsDataEntity:WtA,logoEntity:BPc,macroMarkerEntity:H6g,
mainDownloadsLibraryEntity:YBw,mainDownloadsListEntity:MPA,mainPlaylistDownloadStateEntity:s$p,mainPlaylistEntity:CMA,mainPlaylistVideoEntity:NPp,mainVideoDownloadStateEntity:xCA,mainVideoEntity:b67,markersEngagementPanelSyncEntity:TPH,markersVisibilityOverrideEntity:R5n,musicAlbumReleaseDetail:aMH,musicAlbumReleaseDownloadMetadataEntity:v6c,musicAlbumRelease:fMq,musicAlbumReleaseUserDetail:ixA,musicArtistDetail:Oxn,musicArtist:SEA,musicArtistUserDetail:Zxn,musicDownloadsLibraryEntity:QYM,musicLibraryEdit:mG7,
musicLibraryStatusEntity:tIg,musicPlaylist:JuA,musicPlaylistDownloadMetadataEntity:Auc,musicShare:ruw,musicTrackDetail:Bfp,musicTrackDownloadMetadataEntity:lMH,musicTrack:VIn,musicTrackUserDetail:w$n,offlineOrchestrationActionWrapperEntity:UGg,offlineVideoPolicy:cuA,offlineVideoStreams:h8M,offlineabilityEntity:e5g,orchestrationWebSamplingEntity:LVs,pageHeaderEntity:uJA,pdpStateEntity:PGA,pinnedProductEntity:FVH,playbackData:YEn,playerStateEntity:PMn,quantityIncrementerEntity:qEA,refresh:X$p,saveToPlaylistListEntity:n6s,
selectedChipIndexEntityPayload:qB5,settingEntity:g6H,stringEntity:SBp,suggestedFeedbackChipStateEntity:oGA,transfer:MIA,trendingOfferEntity:EGg,videoDownloadContextEntity:sYH,videoOverviewAsyncDataEntity:o6A,videoPlaybackPositionEntity:yu5,votingEntity:z8p,ytMainChannelEntity:pDn,youchatPendingResponseEntity:KVn,ytMainDownloadedVideoEntity:nGc,ytMainVideoEntity:WVA};g.d(qs,ASA);qs.prototype.Y=function(k){return k};
qs.prototype.Z=function(k){if(k instanceof Uint8Array)throw koA(0);return k};
g.d(oq,g.W);oq.prototype.observe=function(k){var G=this;this.observers.push(k);return function(){var v=G.observers.indexOf(k);v>=0&&G.observers.splice(v,1)}};
oq.prototype.Z=function(k){UQw(this,k.data)};
oq.prototype.YQ=function(){this.channel.close()};
var M0q,Yww=new g.u$("elementsCommand");var Y2=new g.u$("entityBatchUpdate");var mpn=new g.u$("downloadStatusEntity");var s8A=new g.u$("mainPlaylistEntityActionMetadata");var KU=new g.u$("mainVideoEntityActionMetadata");var j6A=new g.u$("musicPlaylistEntityActionMetadata");var iTA=new g.u$("musicTrackEntityActionMetadata");var yF7=new g.u$("localImageEntityActionMetadata");var u6=new g.u$("playbackDataActionMetadata");var YlA=new g.u$("transferEntityActionMetadata");var O_A=new g.u$("videoPlaybackPositionEntityActionMetadata");var I5p;new g.mX;new g.mX;PaA.prototype.request=function(k,G,v){G=G===void 0?{}:G;return this.locks.request(k,G,function(Q){return v(Q)})};var Qm=g.sA.caches,vm,FKg;G6.prototype.open=function(k){return Qm.open(KKg(k))};
G6.prototype.has=function(k){return Qm.has(KKg(k))};
G6.prototype.delete=function(k){return Qm.delete(KKg(k))};
G6.prototype.match=function(k,G){var v=this,Q,A,l,f,S,O;return g.b(function(Z){switch(Z.j){case 1:return g.N(Z,v.keys(),2);case 2:Q=Z.Z,A=g.n(Q),l=A.next();case 3:if(l.done){Z.As(5);break}f=l.value;return g.N(Z,v.open(f),6);case 6:return S=Z.Z,g.N(Z,S.match(k,G),7);case 7:if(O=Z.Z)return Z.return(O);l=A.next();Z.As(3);break;case 5:return Z.return()}})};
g.d(okp,G6);okp.prototype.keys=function(){var k,G,v,Q,A,l,f,S,O;return g.b(function(Z){if(Z.j==1)return k=[],G=g.Ka("CacheStorage keys"),g.N(Z,Qm.keys(),2);v=Z.Z;Q=g.n(v);for(A=Q.next();!A.done;A=Q.next()){l=A.value;var m=l.indexOf(":");f=m===-1?{vX:l}:{vX:l.substring(0,m),datasyncId:l.substring(m+1)};S=f.vX;O=f.datasyncId;O===G&&k.push(S)}return Z.return(k)})};g.d(l6,g.W);l6.prototype.Y=function(k){this.api.yh("onOfflineOperationFailure",k.data)};
l6.prototype.V=function(k){this.api.publish("offlinetransferpause",k.data)};
l6.prototype.YQ=function(){var k;(k=this.j)==null||k.close();var G;(G=this.Z)==null||G.close()};Gd7.prototype.JP=function(){this.j&&ap(this)};
Gd7.prototype.H9=function(){this.Z&&this.Z.resolve();this.Y=this.j=!1;this.hs()};var WTs=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Up7="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var gwH="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d(GgM,gv);GgM.prototype.Z=function(k){return Za(k)?Aog(this,k):me(k)?aYA(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.d(i_n,gv);i_n.prototype.Z=function(k){return me(k)?SlM(this,k):Z0A(k)?Z_g(this,k):tg(k)?mXn(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.B=tsM.prototype;g.B.WrI=function(k){var G=this,v,Q,A,l;return g.b(function(f){if(!g.P(k.state,128))return f.As(0);v=k.state.bb;var S=(Q=v)==null?void 0:Q.errorCode,O=(A=v)==null?void 0:A.YG;l=S==="net.connect"&&O===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(S==null?0:S.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.N(f,G.UM(G.player.getVideoData().videoId,l),0)})};
g.B.UM=function(k,G){var v=this;return g.b(function(Q){if(Q.j==1){if(v.Z)return Q.return();v.Z=!0;return G==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(b6(v,k,!1,!0),Q.As(0)):g.N(Q,je(v,k),3)}g.IA(k,4);return g.N(Q,v.j.UM(G),0)})};
g.B.qQ=function(k){k.status===2?(k.status!==this.Y&&(iFH(this.j),g.IA(k.videoId,2)),k.kJ&&tjH(this.j,k.videoId,k.kJ)):k.status===4?(je(this,k.videoId),this.UM(k.videoId,k.wI?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&mmH(this.j);this.Y=k.status;this.api.yh("localmediachange",{videoId:k.videoId,status:k.status})};
g.B.vT=function(){var k=this,G;return g.b(function(v){if(v.j==1){if(k.Z)return v.return();k.Z=!0;G=k.player.getVideoData().videoId;return g.N(v,je(k,G),2)}return g.N(v,k.j.vT(),0)})};
g.B.Ot=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.B.X=function(k){return this.api.K().X(k)};g.d(w4A,gv);w4A.prototype.Z=function(k){return Za(k)?UX7(this,k):me(k)?co7(this,k):Z0A(k)?hOg(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};eOA.prototype.j=function(k,G){var v=k.action.actionMetadata.priority-G.action.actionMetadata.priority;v===0&&(k.j<G.j?v=-1:k.j>G.j&&(v=1));return v};g.d(pU,g.W);pU.prototype.YQ=function(){this.hs&&this.hs();g.W.prototype.YQ.call(this)};
pU.prototype.createAction=function(k,G){var v=g.Hb(k.entityKey).entityType,Q=g.VO(16);return new Bm(v,Q,k,G.actionId,G.rootActionId)};
pU.prototype.zN=function(k){var G=this,v,Q,A,l,f,S,O,Z,m;return g.b(function(t){if(t.j==1){if(G.Js())return t.return();Q=(v=k.offlineOrchestrationActionWrapperEntity)!=null?v:new Set;A=[];l=g.n(Q);for(f=l.next();!f.done;f=l.next())S=f.value,O=g.Hb(S),Z=O.entityId,gbH(G.j,Z)||A.push(S);return g.N(t,H_H(G,A),2)}m=t.Z;return g.N(t,yog(G,m),0)})};
pU.prototype.retry=function(){var k=this;return g.b(function(G){return g.N(G,TQM(k),0)})};P5A.prototype.Gg=function(k,G){G=G===void 0?!0:G;var v=this,Q,A,l,f,S,O,Z,m;return g.b(function(t){switch(t.j){case 1:if(!v.j)return t.return();Q=[];A=g.o1(v.j.j,G);l=[];for(f={LT:0};f.LT<A.length;f={LT:f.LT},f.LT++)S=A[f.LT],O=v.j.Oj(S,"json3"),Z=g.u0(O,{withCredentials:!0,format:"RAW"},3,500).then(function(J){return function(r){r={metadata:g.YE(A[J.LT]),trackData:r.xhr.responseText};l.push(r)}}(f)).zx(function(J){Ag("Caption fetch error",J)}),Q.push(Z);
return g.N(t,AAc(Q),2);case 2:return g.OA(t,3),g.N(t,NTg(k,l),5);case 5:g.mc(t,0);break;case 3:m=g.t5(t),Ag("Caption DB transaction error",m),g.SH(t)}})};g.d(Wm,g.W);Wm.prototype.YQ=function(){this.Z&&this.Z();g.W.prototype.YQ.call(this)};
Wm.prototype.Y=function(k){var G=this,v,Q,A,l,f,S,O,Z;return g.b(function(m){Q=(v=k.transfer)!=null?v:new Set;A=[];l=g.n(Q);for(f=l.next();!f.done;f=l.next())S=f.value,O=g.Hb(S),Z=O.entityId,A.push(Z);return A.length===0?m.return():g.N(m,KTw(G,A),0)})};g.d(GDn,g.W);g.B=GDn.prototype;g.B.YQ=function(){this.Vh&&this.Vh();this.XI.dispose();this.V.dispose();this.GN&&g.a8(this.G.Te,this.GN);this.qV&&g.a8(this.G.Te,this.qV);g.W.prototype.YQ.call(this)};
g.B.lhl=function(k){var G=this,v,Q,A;return g.b(function(l){switch(l.j){case 1:v=g.Tz(k,"transfer");if(G.j&&v===G.j.key){b6(G.W,G.S,!0);G.V.stop();l.As(0);break}return g.N(l,K4(G.Z,{mode:"readwrite",O7:!0},function(f){return yT(f,v,"transfer").then(function(S){if(S&&S.transferState!=="TRANSFER_STATE_COMPLETE"&&S.transferState!=="TRANSFER_STATE_FAILED")return S.transferState="TRANSFER_STATE_PAUSED_BY_USER",Rq(f,S,"transfer").then(function(){return S})})}),3);
case 3:Q=l.Z;if(!Q){l.As(0);break}if(!k||!G.Y){l.As(5);break}return g.N(l,$2(k,G.Y,G.Z,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.N(l,Hm(G,k),7);case 7:A=l.Z,Sws({videoId:k,qf:Q,offlineModeType:A}),g.SH(l)}})};
g.B.AWI=function(){var k=this;if(this.j&&this.S){b6(this.W,this.S,!1);var G=this.j,v=(G==null?0:G.key)?g.Hb(G.key).entityId:"";v&&this.Y&&(new Promise(function(Q,A){$2(v,k.Y,k.Z,"DOWNLOAD_STATE_PAUSED").catch(function(l){A(l)})})).catch(function(Q){Ag("Download state setting error",Q)})}this.V.stop()};
g.B.gW=function(){this.j?AF7(this,this.j):ym(this)};
g.B.LQ=function(k){var G=this;return g.b(function(v){switch(v.j){case 1:if(!G.j){v.As(2);break}if(G.j.transferState==="TRANSFER_STATE_COMPLETE"||G.j.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(G.j.key)){v.As(3);break}return g.N(v,F0(G.Z,G.j.key,"transfer"),4);case 4:G.j=v.Z;if(G.j){v.As(3);break}return g.N(v,luq(G),3);case 3:if(G.j)return v.return();case 2:return g.N(v,ym(G),0)}})};
g.B.UM=function(k,G){var v=this,Q,A,l,f,S;return g.b(function(O){switch(O.j){case 1:if(!v.j){T6(v,"onTransferFailure: "+k);O.As(2);break}Q=v.j;l=((A=Q)==null?0:A.key)?g.Hb(Q.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Z=!1;break a;default:Z=!0}return Z&&$mq(v)?g.N(O,Rp(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.N(O,
JF7(v,k),5);case 5:if(!l||!v.Y){O.As(2);break}return g.N(O,$2(l,v.Y,v.Z,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.N(O,Hm(v,l),9);case 9:f=O.Z;Se({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:l,qf:Q,offlineModeType:f});if(!l||!v.Y){O.As(2);break}return g.N(O,$2(l,v.Y,v.Z,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Ip(v),S=ym(v,!0),G&&G(S),g.SH(O)}})};
g.B.vT=function(k){var G=this,v,Q,A,l,f,S,O,Z,m,t,J,r;return g.b(function(V){switch(V.j){case 1:if(!G.j){T6(G,"onMaybeTransferStreamsExpired");V.As(2);break}return $mq(G)?g.N(V,Rp(G,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.N(V,JF7(G,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!G.Y){V.As(2);break}v=G.j;A=((Q=v)==null?0:Q.key)?g.Hb(v.key).entityId:"";if(!A){V.As(2);break}return g.N(V,$2(A,G.Y,G.Z,"DOWNLOAD_STATE_FAILED"),2);case 9:return G.j||T6(G,"onMaybeTransferStreamsExpiredRetryAttempting"),
l=G.j,S=((f=l)==null?0:f.key)?g.Hb(l.key).entityId:"",g.N(V,Hm(G,S),10);case 10:return O=V.Z,Se({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:S,qf:l,offlineModeType:O}),Z=Jkg(),g.jA(Z,u6,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m=g.Tz(S,"playbackData"),t={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:m,actionMetadata:Z},J=dv(new Bm("playbackData",S,t)),g.N(V,Dg(G.Z,J,"offlineOrchestrationActionWrapperEntity"),2);case 2:Ip(G),r=ym(G,!0),
k&&k(r),g.SH(V)}})};
var w6g={},rFg=(w6g.TRANSFER_STATE_TRANSFERRING=1,w6g.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,w6g);g.B=Pm.prototype;g.B.aL=function(){return this.S.promise};
g.B.bz=function(){if(this.Z&&this.W)return this.S.promise;weH(this).then(this.S.resolve).catch(this.S.reject);return this.S.promise};
g.B.Zm=function(k){var G={};return G.playbackData=new GgM(k,this.B,this.j),G.transfer=new w4A(k,this.B),G.videoPlaybackPositionEntity=new i_n(k,this.B),G};
g.B.M8=function(){var k=this;return g.b(function(G){return k.Z?g.N(G,v7H(k.Z),0):G.As(0)})};
g.B.e_=function(){var k=this,G,v;return g.b(function(Q){if(Q.j==1)return k.Z||k.W?g.N(Q,k.aL(),2):Q.return();k.D!==void 0&&(g.YV(k.D),k.D=void 0);k.V!==void 0&&(g.YV(k.V),k.V=void 0);(G=k.Z)==null||G.dispose();k.Z=void 0;(v=k.W)==null||v.dispose();k.W=void 0;k.api.yh("onOrchestrationLostLeader");k.S=new g.mX;g.SH(Q)})};
g.B.isOrchestrationLeader=function(){return this.Y.j};
g.B.Bb=function(){return g.b(function(k){return k.return(!1)})};
g.B.Zf=function(k){var G=this.j;G.api.publish("offlinetransferpause",k);var v;(v=G.Z)==null||v.postMessage(k)};
g.B.gW=function(k){var G,v;return g.b(function(Q){if(Q.j==1)return g.N(Q,k2(),2);G=Q.Z;if(!G)return Q.return();v=g.Tz(k,"transfer");return g.N(Q,K4(G,{mode:"readwrite",O7:!0},function(A){var l=yT(A,v,"transfer"),f=yT(A,g.Tz(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.cK.all([l,f]).then(function(S){S=g.n(S);var O=S.next().value;var Z=S.next().value;return O&&O.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(O.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Rq(A,O,"transfer").then(function(){Se({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,qf:O,offlineModeType:Z==null?void 0:Z.offlineModeType});return g.cK.resolve(null)})):g.cK.resolve(null)})}),0)})};
g.B.W3=function(k){k=k===void 0?43200:k;var G=this,v,Q,A,l,f,S,O,Z;return g.b(function(m){if(m.j==1)return G.G.oF()?g.N(m,k2(),2):m.return(dms());if(m.j!=3){v=m.Z;if(!v)return m.return([]);Q=Date.now()/1E3;return g.N(m,E2(v,"offlineVideoPolicy"),3)}A=m.Z;l=[];f=g.n(A);for(S=f.next();!S.done;S=f.next())O=S.value,Number(O.lastUpdatedTimestampSeconds)+k<=Q&&(Z=g.Hb(O.key).entityId,l.push(Z));return l.length?m.return(qP(G,l,G.hs,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):m.return([])})};
g.B.deleteAll=function(){return qP(this,["!*$_ALL_ENTITIES_!*$"],this.hs,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.B.refreshAllStaleEntities=function(k){var G=this;return g.b(function(v){return v.j==1?g.N(v,G.W3(k),2):v.return(v.Z)})};
g.B.setUpPositionSyncInterval=function(k){var G=this;this.V!==void 0&&(g.YV(this.V),this.V=void 0);var v=k!=null?k:864E5;this.V=g.cH(function(){G.aE(v)},v)};
g.B.aE=function(k){var G=this,v,Q,A,l,f,S;return g.b(function(O){switch(O.j){case 1:return g.OA(O,2),g.N(O,p4.getInstance(),4);case 4:v=O.Z;if(!v)throw Error("prefStorage is undefined");return g.N(O,v.get("psi"),5);case 5:Q=O.Z;l=((A=Q)==null?0:A.u1)?Number(Q.u1)/1E3:0;f=Date.now();if(!(l+k<=f)){O.As(6);break}return g.N(O,qP(G,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.mc(O,0);break;case 2:S=g.t5(O),Ag("Offline manager error",S),
g.SH(O)}})};
g.B.KD=function(){var k=this,G,v,Q,A,l,f,S;return g.b(function(O){if(O.j==1)return g.N(O,k2(),2);if(O.j!=3)return(G=O.Z)?g.N(O,E2(G,"transfer"),3):O.return([]);v=O.Z;Q=[];A=g.n(v);for(l=A.next();!l.done;l=A.next())f=l.value,f.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&f.key&&(S=g.Hb(f.key).entityId,Q.push(S));return O.return(cF7(k,Q))})};
g.B.vN=function(){return g.b(function(k){return k.return([])})};
g.B.sV=function(){return g.b(function(k){g.SH(k)})};
g.B.m4=function(){return g.b(function(k){g.SH(k)})};g.d(hdq,gv);hdq.prototype.Z=function(k){return Za(k)?Mj7(this,k):me(k)?xmp(this,k):tg(k)?edc(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var op=[10];g.d(NzA,gv);NzA.prototype.Z=function(k){return Za(k)?j8p(this,k):me(k)?bFn(this,k):tg(k)?peH(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var zdH=[10];g.d(Iug,gv);Iug.prototype.Z=function(k){return me(k)?HF7(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.d(TzA,Pm);g.B=TzA.prototype;g.B.Zm=function(k){var G=Pm.prototype.Zm.call(this,k);G.mainVideoEntity=new NzA(k,this.B,this.j);G.mainPlaylistEntity=new hdq(k,this.B,this.j);G.mainDownloadsListEntity=new Iug(k,this.B,this.j);return G};
g.B.refreshAllStaleEntities=function(k,G){var v=this,Q,A,l,f,S,O,Z,m,t,J,r;return g.b(function(V){switch(V.j){case 1:Q=[];if(!v.B.X("web_player_offline_playlist_auto_refresh")){V.As(2);break}return g.N(V,Rdn(v,k,G),3);case 3:Q=V.Z;case 2:return g.N(V,p4.getInstance(),4);case 4:return A=V.Z,g.N(V,(l=A)==null?void 0:l.get("sdois"),5);case 5:return f=V.Z,g.N(V,(S=A)==null?void 0:S.get("lmqf"),6);case 6:O=V.Z;if(!f){V.As(7);break}m=Q;t=m.concat;return g.N(V,PU5(v,f,(Z=O)!=null?Z:"SD",k===0),8);case 8:Q=
t.call(m,V.Z);case 7:return J=Q,r=J.concat,g.N(V,Pm.prototype.refreshAllStaleEntities.call(v,k,G),9);case 9:return Q=r.call(J,V.Z),V.return(Q)}})};
g.B.Bb=function(k){var G,v,Q,A,l,f,S,O;return g.b(function(Z){if(Z.j==1)return g.N(Z,k2(),2);if(Z.j!=3)return(G=Z.Z)?g.N(Z,F0(G,g.zv,"mainDownloadsListEntity"),3):Z.return(!1);v=Z.Z;if((Q=v)==null?0:(A=Q.downloads)==null?0:A.length)for(l=g.Tz(k,"mainVideoEntity"),f=g.n(v.downloads),S=f.next();!S.done;S=f.next())if(O=S.value,O.videoItem===l)return Z.return(!0);return Z.return(!1)})};
g.B.vN=function(){var k=this,G,v,Q,A,l,f,S,O;return g.b(function(Z){if(Z.j==1)return g.N(Z,k2(),2);if(Z.j!=3)return(G=Z.Z)?g.N(Z,E2(G,"downloadStatusEntity"),3):Z.return([]);v=Z.Z;Q=[];A=g.n(v);for(l=A.next();!l.done;l=A.next())f=l.value,f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&f.key&&(S=g.Hb(f.key).entityId,Q.push(S));return Q.length?(O={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Z.return(qP(k,Q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
O))):Z.return([])})};
g.B.m4=function(){var k;return g.b(function(G){return G.j==1?g.N(G,k2(),2):(k=G.Z)?g.N(G,K4(k,{mode:"readwrite",O7:!0},function(v){return Hg(v,"mainVideoEntity").then(function(Q){var A=[];Q=g.n(Q);for(var l=Q.next();!l.done;l=Q.next()){l=l.value;var f=void 0;(f=l.userState)!=null&&f.playbackPosition||(f=g.Hb(l.key).entityId,f={key:g.Tz(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:"0"},A.push(Rq(v,f,"videoPlaybackPositionEntity")),l.userState={playbackPosition:f.key},A.push(Rq(v,
l,"mainVideoEntity")))}return g.cK.all(A)})}),0):G.return()})};
g.B.sV=function(){var k,G,v,Q,A,l,f,S,O,Z,m,t,J,r,V,U,h,L,e,C,u,T,y,Ac,E,k3,iE,Zb,Ql,Y3,Gn,iA,fg,R7,o7,Kg,ng,x;return g.b(function(wA){if(wA.j==1)return g.N(wA,k2(),2);if(wA.j!=3){k=wA.Z;if(!k)return wA.return();G=g.Tz("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.N(wA,K4(k,{mode:"readonly",O7:!0},function(qw){return g.cK.all([yT(qw,G,"mainDownloadsListEntity"),yT(qw,g.zv,"mainDownloadsListEntity"),Hg(qw,"mainVideoEntity"),Hg(qw,"mainPlaylistEntity")])}),3)}v=wA.Z;
Q=g.n(v);A=Q.next().value;l=Q.next().value;f=Q.next().value;S=Q.next().value;O=A;Z=l;m=f;t=S;J=new Set;if((r=O)==null?0:(V=r.downloads)==null?0:V.length)for(U=g.n(O.downloads),h=U.next();!h.done;h=U.next())L=h.value,e=void 0,(C=(e=L.videoItem)!=null?e:L.playlistItem)&&J.add(C);if((u=Z)==null?0:(T=u.downloads)==null?0:T.length)for(y=g.n(Z.downloads),Ac=y.next();!Ac.done;Ac=y.next())E=Ac.value,E.videoItem&&J.add(E.videoItem);k3=new Set;iE=[];Zb=g.n(t);for(Ql=Zb.next();!Ql.done;Ql=Zb.next()){Y3=Ql.value;
if(Y3.videos)for(Gn=g.n(Y3.videos),iA=Gn.next();!iA.done;iA=Gn.next())fg=iA.value,(R7=JSON.parse(g.Hb(fg).entityId).videoId)&&k3.add(R7);Y3.key&&!J.has(Y3.key)&&iE.push(Y3.key)}o7=g.n(m);for(Kg=o7.next();!Kg.done;Kg=o7.next())ng=Kg.value,ng.key&&!J.has(ng.key)&&(x=g.Hb(ng.key).entityId,k3.has(x)||iE.push(ng.key));return iE.length?g.N(wA,xpA(k,iE),0):wA.As(0)})};g.d(qaH,gv);qaH.prototype.Z=function(k){return Za(k)?K1H(this,k):me(k)?Dmg(this,k):tg(k)?F1A(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var Da=[10];g.d(kAA,gv);kAA.prototype.Z=function(k){return Za(k)?v0q(this,k):me(k)?QXc(this,k):tg(k)?AwH(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var FU=[10];g.d(ay7,gv);ay7.prototype.Z=function(k){return Za(k)?ZTH(this,k):me(k)?m6A(this,k):tg(k)?tv5(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var OTn=[10];g.d(Eg,Pm);Eg.prototype.Zm=function(k){var G=Pm.prototype.Zm.call(this,k);G.musicTrack=new ay7(k,this.j);G.musicPlaylist=new kAA(k,this.j);G.musicAlbumRelease=new qaH(k,this.j);return G};
Eg.prototype.refreshAllStaleEntities=function(k,G){var v=this,Q,A,l;return g.b(function(f){if(f.j==1)return g.N(f,Jww(v,k,G),2);if(f.j!=3)return A=Q=f.Z,l=A.concat,g.N(f,Pm.prototype.refreshAllStaleEntities.call(v,k,G),3);Q=l.call(A,f.Z);return f.return(Q)})};g.d(rwg,g.Jm);g.B=rwg.prototype;g.B.create=function(){var k=this;g.I(this,this.events);if(g.Al(this.B))this.j=new TzA(this.B,this.player);else if(g.jh(this.B)||g.fu(this.B))this.j=new Eg(this.B,this.player);this.events.U(this.player,"onPlaybackStartExternal",function(){k.f5()});
this.events.U(this.player,"videodatachange",function(){k.f5()});
this.B.X("html5_offline_playback_position_sync")&&this.events.U(this.player,"presentingplayerstatechange",this.vI)};
g.B.nf=function(){return!1};
g.B.Eb=function(k,G,v,Q){var A=this;return g.b(function(l){return A.j?l.return(qP(A.j,k,G,v,Q)):l.return(Promise.reject())})};
g.B.deleteAll=function(){return this.j.deleteAll()};
g.B.W3=function(k){return this.j.W3(k)};
g.B.refreshAllStaleEntities=function(k){return this.j.refreshAllStaleEntities(k)};
g.B.setUpPositionSyncInterval=function(k){this.j.setUpPositionSyncInterval(k)};
g.B.Zf=function(k){this.j.Zf(k)};
g.B.gW=function(k){return this.j.gW(k)};
g.B.f5=function(){var k=this,G;return g.b(function(v){G=k.player.getVideoData();return g.Qf(G)?Vvg(G)&&k.Z!==G.clientPlaybackNonce?g.N(v,BL7(k,G),0):v.As(0):v.return()})};
g.B.vI=function(k){var G=this,v,Q,A,l,f,S,O;return g.b(function(Z){if(Z.j==1)return v=G.player.getVideoData(),Q=v.GC,g.$C(k,2)||g.$C(k,512)?g.N(Z,k2(),2):Z.return();if(Z.j!=3){A=Z.Z;if(!A)return Ag("PES is undefined"),Z.return();l=v.videoId;return g.N(Z,F0(A,g.Tz(l,"mainVideoEntity"),"mainVideoEntity"),3)}f=Z.Z;if(!f)return Z.return();S=Math.floor(Q).toString();O={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:S}};return g.N(Z,G.Eb([l],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
O),0)})};
g.B.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.B.updateDownloadState=function(k,G){var v,Q,A,l;return g.b(function(f){if(f.j==1)return g.N(f,k2(),2);v=f.Z;if(!v)return Ag("PES is undefined"),f.return();Q=g.Hb(k);A=Q.entityType;l=Q.entityId;return g.N(f,$2(l,A,v,G,!0),0)})};g.$X("offline",rwg);})(_yt_player);
